graph TB
    %% User Management Flow - End User and Platform Manager Perspectives
    %% Better Together Community Engine
    
    %% User Registration Flow
    subgraph "User Registration Flow"
        A[User Initiates Registration] --> B{Platform Privacy?}
        B -->|Public| C[Direct Registration Form]
        B -->|Private/Invitation-Only| D[Invitation Code Required]
        
        D --> E{Valid Invitation Code?}
        E -->|No| F[Show Code Entry Form]
        E -->|Yes| G[Pre-filled Registration Form]
        F --> H[User Enters Code]
        H --> E
        
        C --> I[Registration Form]
        G --> I
        
        I --> J[User Fills Form]
        J --> K{Form Valid?}
        K -->|No| L[Show Validation Errors]
        L --> J
        
        K -->|Yes| M[Create User Account]
        M --> N[Create Person Profile]
        N --> O[Process Legal Agreements]
        
        O --> P{Invitation Present?}
        P -->|Yes| Q[Apply Invitation Roles]
        P -->|No| R[Default Community Member]
        
        Q --> S[Mark Invitation Accepted]
        R --> T[Send Confirmation Email]
        S --> T
        
        T --> U[User Checks Email]
        U --> V[Click Confirmation Link]
        V --> W[Account Activated]
        W --> X[Sign In Available]
    end
    
    %% Platform Manager Invitation Management
    subgraph "Platform Manager - Invitation System"
        PM1[Platform Manager Access] --> PM2[Host Dashboard]
        PM2 --> PM3[Platform Management]
        PM3 --> PM4{Create New Invitation?}
        
        PM4 -->|Yes| PM5[New Invitation Form]
        PM4 -->|No| PM6[View Existing Invitations]
        
        PM5 --> PM7[Set Invitation Details]
        PM7 --> PM8[Assign Roles]
        PM8 --> PM9[Set Validity Period]
        PM9 --> PM10[Add Personal Message]
        PM10 --> PM11[Create Invitation]
        
        PM11 --> PM12[Generate Invitation Token]
        PM12 --> PM13[Queue Invitation Email]
        PM13 --> PM14[Background Email Job]
        PM14 --> PM15[Email Delivered]
        
        PM6 --> PM16[Invitation List View]
        PM16 --> PM17{Invitation Actions?}
        PM17 -->|View URL| PM18[Copy Invitation Link]
        PM17 -->|Resend| PM19[Resend Email Job]
        PM17 -->|Delete| PM20[Remove Invitation]
        
        PM19 --> PM14
    end
    
    %% User Authentication Flow
    subgraph "User Authentication"
        AUTH1[User Sign In Attempt] --> AUTH2[Enter Email/Password]
        AUTH2 --> AUTH3{Credentials Valid?}
        
        AUTH3 -->|No| AUTH4[Show Login Error]
        AUTH4 --> AUTH5{Too Many Attempts?}
        AUTH5 -->|Yes| AUTH6[Account Lockout]
        AUTH5 -->|No| AUTH2
        
        AUTH3 -->|Yes| AUTH7{Account Confirmed?}
        AUTH7 -->|No| AUTH8[Resend Confirmation]
        AUTH7 -->|Yes| AUTH9[Load User Session]
        
        AUTH9 --> AUTH10[Check Platform Privacy]
        AUTH10 --> AUTH11{Private Platform?}
        AUTH11 -->|Yes| AUTH12{Valid Invitation?}
        AUTH12 -->|No| AUTH13[Access Denied]
        AUTH12 -->|Yes| AUTH14[Grant Access]
        AUTH11 -->|No| AUTH14
        
        AUTH14 --> AUTH15[Load User Context]
        AUTH15 --> AUTH16[Cache Permissions]
        AUTH16 --> AUTH17[Redirect to Dashboard]
    end
    
    %% Platform Manager User Support
    subgraph "Platform Manager - User Support"
        SUP1[Support Request Received] --> SUP2[Categorize Issue]
        SUP2 --> SUP3{Issue Type?}
        
        SUP3 -->|Authentication| SUP4[Check Account Status]
        SUP3 -->|Profile| SUP5[Review Profile Data]
        SUP3 -->|Community Access| SUP6[Check Memberships]
        SUP3 -->|Technical| SUP7[System Diagnostics]
        
        SUP4 --> SUP8[Password Reset Tools]
        SUP4 --> SUP9[Email Verification]
        SUP4 --> SUP10[Account Unlock]
        
        SUP5 --> SUP11[Edit Profile Access]
        SUP5 --> SUP12[Privacy Settings]
        SUP5 --> SUP13[Username Changes]
        
        SUP6 --> SUP14[Role Assignment]
        SUP6 --> SUP15[Community Membership]
        SUP6 --> SUP16[Permission Updates]
        
        SUP7 --> SUP17[Error Log Analysis]
        SUP7 --> SUP18[System Health Check]
        SUP7 --> SUP19[Escalate to Tech Team]
        
        SUP8 --> SUP20[Implement Solution]
        SUP9 --> SUP20
        SUP10 --> SUP20
        SUP11 --> SUP20
        SUP12 --> SUP20
        SUP13 --> SUP20
        SUP14 --> SUP20
        SUP15 --> SUP20
        SUP16 --> SUP20
        SUP17 --> SUP20
        SUP18 --> SUP20
        
        SUP20 --> SUP21[Test Resolution]
        SUP21 --> SUP22[Notify User]
        SUP22 --> SUP23[Document Solution]
        SUP23 --> SUP24[Close Support Ticket]
    end
    
    %% User Profile Management
    subgraph "User Profile Management"
        PROF1[User Profile Access] --> PROF2[View Profile Page]
        PROF2 --> PROF3{Edit Profile?}
        PROF3 -->|No| PROF4[View Only Mode]
        PROF3 -->|Yes| PROF5{User Owns Profile?}
        
        PROF5 -->|No| PROF6[Permission Check]
        PROF6 --> PROF7{Admin Access?}
        PROF7 -->|No| PROF4
        PROF7 -->|Yes| PROF8[Admin Edit Mode]
        
        PROF5 -->|Yes| PROF9[User Edit Mode]
        
        PROF8 --> PROF10[Edit Profile Form]
        PROF9 --> PROF10
        
        PROF10 --> PROF11[Update Information]
        PROF11 --> PROF12{Changes Valid?}
        PROF12 -->|No| PROF13[Show Validation Errors]
        PROF13 --> PROF10
        
        PROF12 -->|Yes| PROF14[Save Changes]
        PROF14 --> PROF15[Update Search Index]
        PROF15 --> PROF16[Broadcast Updates]
        PROF16 --> PROF17[Show Success Message]
    end
    
    %% Platform Manager User Administration
    subgraph "Platform Manager - User Administration"
        ADM1[User Administration Access] --> ADM2[User Directory]
        ADM2 --> ADM3[View All Users List]
        ADM3 --> ADM4{Select User Action?}
        
        ADM4 -->|View Details| ADM5[User Profile View]
        ADM4 -->|Edit Account| ADM6[Admin Edit Access]
        ADM4 -->|Role Management| ADM7[Role Assignment Interface]
        ADM4 -->|Delete Account| ADM8[Account Deletion Workflow]
        
        ADM5 --> ADM9[Review User Activity]
        ADM9 --> ADM10[Community Memberships]
        ADM10 --> ADM11[Content History]
        ADM11 --> ADM12[Support History]
        
        ADM6 --> ADM13[Modify Account Details]
        ADM13 --> ADM14[Update Profile Information]
        ADM14 --> ADM15[Audit Log Entry]
        
        ADM7 --> ADM16[Platform Role Assignment]
        ADM7 --> ADM17[Community Role Assignment]
        ADM16 --> ADM18[Permission Recalculation]
        ADM17 --> ADM18
        ADM18 --> ADM19[Cache Permission Updates]
        
        ADM8 --> ADM20[Data Export Option]
        ADM20 --> ADM21[Confirmation Required]
        ADM21 --> ADM22[Account Deletion]
        ADM22 --> ADM23[Data Cleanup Jobs]
        ADM23 --> ADM24[Audit Trail Update]
    end
    
    %% Security and Monitoring
    subgraph "Security and Monitoring"
        SEC1[Security Monitoring] --> SEC2[Failed Login Detection]
        SEC2 --> SEC3{Suspicious Activity?}
        SEC3 -->|Yes| SEC4[Account Lockout]
        SEC3 -->|No| SEC5[Normal Activity Logging]
        
        SEC4 --> SEC6[Security Alert]
        SEC6 --> SEC7[Platform Manager Notification]
        SEC7 --> SEC8[Investigation Required]
        
        SEC5 --> SEC9[Activity Analytics]
        SEC9 --> SEC10[User Engagement Tracking]
        SEC10 --> SEC11[Platform Health Monitoring]
        
        SEC8 --> SEC12[Account Analysis]
        SEC12 --> SEC13{Security Risk?}
        SEC13 -->|Yes| SEC14[Enhanced Security Measures]
        SEC13 -->|No| SEC15[Account Recovery Process]
        
        SEC14 --> SEC16[Password Reset Required]
        SEC15 --> SEC17[User Notification]
        SEC16 --> SEC18[Security Incident Documentation]
    end
    
    %% Styling
    classDef userAction fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef adminAction fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef systemProcess fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef errorState fill:#ffebee,stroke:#b71c1c,stroke-width:2px
    classDef securityProcess fill:#fff3e0,stroke:#e65100,stroke-width:2px
    
    class A,J,U,V,X,AUTH1,AUTH2,PROF1,PROF2,PROF3 userAction
    class PM1,PM5,PM6,SUP1,SUP2,ADM1,ADM2,ADM3 adminAction
    class M,N,O,T,PM11,PM12,PM13,PM14,AUTH9,AUTH15,AUTH16 systemProcess
    class L,AUTH4,AUTH6,AUTH13,PROF13,SEC4,SEC6 errorState
    class SEC1,SEC2,SEC8,SEC12,SEC14,SEC16 securityProcess
