
Randomized with seed 40244

BetterTogether::Metrics::PageView
  UTF-8 URL handling in set_page_url
[32m    handles URL-encoded UTF-8 characters[0m
[32m    parses UTF-8 URLs correctly[0m
[32m    extracts path correctly from UTF-8 URLs[0m
    when handling UTF-8 URLs manually
[32m      handles UTF-8 URLs without errors[0m

BetterTogether::NewMessageNotifier
[32m  includes unread notification count in message[0m

BetterTogether::Joatu::OfferPolicy
  #update?
[32m    allows a manager[0m
[32m    denies other users[0m
[32m    allows the creator[0m
  #show?
[32m    is expected to equal true[0m
[32m    is expected to equal false[0m
  #index?
[32m    is expected to equal false[0m
[32m    is expected to equal true[0m
  #create?
[32m    is expected to equal false[0m
[32m    is expected to equal true[0m
  #destroy?
[32m    allows the creator[0m
[32m    allows a manager[0m
[32m    denies other users[0m
  Scope
    guest
[32m      returns none[0m
    authenticated user
[32m      includes all offers[0m

MyJob
[32m  queues the job[0m
[32m  is in urgent queue[0m
[32m  executes perform[0m

Platform Privacy with Event Invitations
  invitation token session management
[32m    clears expired invitation tokens from session[0m
  accessing private platform via event invitation token
    when platform is public
[32m      still processes invitation tokens on public platforms for private events[0m
[32m      allows unauthenticated access to public events regardless of invitation tokens[0m
    when platform is private and user is not authenticated
[32m      stores invitation token in session for later use[0m
[32m      redirects to login for expired invitation tokens[0m
[32m      allows access to event via invitation token[0m
    when platform is private and user is authenticated
[32m      still processes invitation tokens for authenticated users[0m
[32m      allows authenticated users to access events normally[0m
  registration with event invitation tokens
[32m    redirects to event after successful registration via invitation[0m
  event invitation URL generation
[32m    generates URLs with invitation tokens that link directly to events[0m
[32m    generated URLs bypass platform privacy restrictions[0m

BetterTogether::Geography::RegionSettlementsHelper
[32m  exists[0m

BetterTogether::Metrics::ReportsHelper
[32m  exists[0m

BetterTogether::Joatu::ResponseLinksController
[32m  prevents creating a response when source is closed[0m
[32m  creates a response and marks the source matched when allowed[0m

BetterTogether::WizardStepDefinition
  Factory
[32m    has a valid factory[0m
  ActiveRecord associations
[32m    is expected to have many wizard_steps[0m
[32m    is expected to belong to wizard required:[0m
  Methods
    #template_path
[32m      returns the default path to the template[0m
    #routing_path
[32m      returns the correct routing path[0m
    #build_wizard_step
[32m      builds a new wizard step with the correct attributes[0m
    #create_wizard_step
[32m      creates a new wizard step and saves it[0m
  Attributes
[32m    is expected to respond to #message[0m
[32m    is expected to respond to #form_class[0m
[32m    is expected to respond to #step_number[0m
[32m    is expected to respond to #identifier[0m
[32m    is expected to respond to #template[0m
[32m    is expected to respond to #name[0m
[32m    is expected to respond to #description[0m
[32m    is expected to respond to #protected[0m
  ActiveModel validations
[32m    is expected to validate that :message cannot be empty/falsy[0m
[32m    is expected to validate that :name cannot be empty/falsy[0m
[32m    is expected to validate that :step_number looks like an integer greater than 0[0m
[32m    is expected to validate that :step_number is case-sensitively unique within the scope of :wizard_id[0m
[32m    is expected to validate that :identifier is case-insensitively unique within the scope of :wizard_id[0m
[32m    is expected to validate that :description cannot be empty/falsy[0m

email notification preferences
[32m  is disabled on the instance model when unchecked on the form[0m
[32m  is enabled by default[0m

BetterTogether::PhoneNumber
[32m  exists[0m

BetterTogether::EventAttendance draft event validation
  validation for scheduled events
[32m    allows RSVP for scheduled events[0m
[32m    prevents RSVP for draft events[0m

Mobility Attachments Backend (prototype)
[32m  defines localized accessors for configured attribute[0m

Translatable Attachments API parity
[32m  defines locale-specific and non-locale accessors[0m
[32m  delegates non-locale accessors to current Mobility.locale[0m

BetterTogether::Geography::SettlementsController
  GET /:locale/.../host/geography/settlements/:id
[32m    renders show[0m
  GET /:locale/.../host/geography/settlements
[32m    renders index[0m

BetterTogether::Metrics::PageView
[32m  rejects URLs containing sensitive parameters[0m
[32m  normalizes page_url to exclude query strings[0m

Respond with Offer visibility
[32m  does not render Respond with Offer button on a request that is a response to my offer[0m

BetterTogether::Metrics::TrackPageViewJob
[32m  exists[0m

better_together/content/blocks/_css.html.erb
  when CSS block has blank content
[32m    does not render a style tag[0m
  when CSS block has content
[32m    renders a style tag[0m
[32m    includes the block DOM ID[0m
[32m    includes the CSS content[0m
    with media queries
[32m      renders media queries correctly[0m
    with dangerous CSS patterns
[32m      sanitizes dangerous expression() calls[0m
[32m      sanitizes javascript: URLs[0m
    with attribute selectors containing quotes
[32m      renders quotes correctly without HTML escaping[0m
    with pseudo-selectors and content property
[32m      renders pseudo-selectors and content values correctly[0m
    with important declarations
[32m      renders important declarations correctly[0m
    with CSS custom properties
[32m      renders CSS custom properties correctly[0m
    with complex real-world CSS
[32m      renders all CSS patterns correctly without escaping[0m
    with child selectors
[32m      renders child selectors correctly without HTML escaping[0m
  when CSS block has no content
[32m    does not render a style tag[0m

BetterTogether::Events datetime fields partial
  form rendering
[32m    shows proper labels and hints[0m
[32m    includes duration field with default value setup[0m
[32m    renders the datetime fields partial correctly[0m
  form submission with datetime fields
[32m    processes form data correctly with partial[0m

BetterTogether::Metrics::Utf8UrlHandler
  #encode_utf8_url
[32m    leaves valid ASCII URLs unchanged[0m
[32m    encodes the Ukrainian URL correctly[0m
[32m    handles complex URLs with query parameters[0m
[32m    handles international domain names[0m
[32m    handles URLs without protocols[0m
[32m    preserves protocol and domain[0m
  integration tests with real-world URLs
[32m    handles all real-world UTF-8 URLs without errors[0m
[32m    produces valid encoded URLs that can be parsed by Ruby URI[0m
  #safe_parse_uri
    with invalid URLs
[32m      returns nil for malformed URLs[0m
[32m      returns nil for blank URLs[0m
    with valid ASCII URLs
[32m      parses simple HTTP URLs[0m
[32m      parses HTTPS URLs with paths and queries[0m
    with UTF-8 URLs
[32m      parses Cyrillic URLs[0m
[32m      parses Arabic URLs[0m
[32m      parses URLs with accented characters[0m
[32m      parses Thai URLs[0m
[32m      parses Japanese URLs[0m
[32m      parses Hebrew URLs[0m
[32m      parses URLs with emoji[0m
[32m      parses German URLs with special characters[0m
[32m      parses UTF-8 URLs with spaces (Ukrainian example)[0m
[32m      parses Chinese URLs with query parameters[0m
  #encode_host_component
[32m    leaves ASCII domains unchanged[0m
[32m    handles host with path[0m
[32m    handles international domain names[0m
  edge cases and error handling
[32m    handles URLs with special characters in different positions[0m
[32m    handles URLs with mixed encodings[0m
[32m    handles very long UTF-8 URLs[0m
[32m    handles URLs with multiple consecutive spaces[0m
  #valid_utf8_url?
[32m    allows specific schemes only[0m
    with invalid URLs
[32m      returns false for invalid URLs[0m
    with valid URLs
[32m      returns true for valid URLs[0m
  #encode_utf8_component
[32m    encodes Ukrainian characters with spaces[0m
[32m    handles empty and nil inputs[0m
[32m    encodes various UTF-8 characters[0m
[32m    handles mixed ASCII and UTF-8[0m
[32m    leaves ASCII characters unchanged[0m
[32m    encodes spaces correctly[0m

BetterTogether::MessagesChannel
[32m  streams for the current person on subscribe[0m
[32m  does not raise on unsubscribe[0m

BetterTogether::Metrics::LinkClickReportsController download
[32m  downloads an attached report file[0m

BetterTogether::Geography::Continent
[32m  exists[0m

Joatu matchmaking
  POST /exchange/agreements
[32m    creates an agreement and accepts it[0m
[32m    rejects an agreement[0m
  GET /exchange/requests/:id/matches
[32m    renders matching offers[0m

BetterTogether::ReportPolicy
[32m  permits create when reporter is agent and reportable is different[0m
[32m  denies create when reporter equals reportable[0m
[32m  denies create when reporter is not agent[0m

Profile Image Performance
  with multiple platform members
[32m    loads platform show page efficiently with profile images[0m
  profile_image_url method performance
[32m    calls profile_image_url without errors when no image is attached[0m

BetterTogether::ApplicationHelper
  #stimulus_debug_enabled?
[32m    returns true when debug param is "true"[0m
[32m    returns false when debug param is not present[0m
[32m    returns false when session is expired[0m
[32m    returns false when session exists but no expiration time[0m
[32m    returns true when session is active and not expired[0m
[32m    prioritizes params over session[0m
  #robots_meta_tag
[32m    renders default robots meta tag[0m
[32m    allows override via content_for[0m
[32m    sets noindex,nofollow when debug mode is enabled[0m
[32m    prioritizes debug mode over content_for[0m

BetterTogether::CalendarEntry
[32m  exists[0m

better_together/shared/invitation_row
  with declined invitation
[32m    renders special resend button for declined invitations[0m
  with pending invitation
[32m    renders normal resend button for pending invitations[0m
  with accepted invitation
[32m    renders normal resend button for accepted invitations[0m

BetterTogether::EventAttendancePolicy draft event restrictions
  #create?
[32m    prevents RSVP for draft events[0m
[32m    allows RSVP for scheduled events[0m
  #update?
[32m    allows updates for scheduled events[0m
[32m    prevents updates for draft events[0m

Invitation expiry access control
[32m  allows access with a valid invitation token and denies after expiry[0m

Respond with Request visibility
[32m  does not render Respond with Request button on an offer that is a response to my request[0m

BetterTogether::CalendarsController
[32m  renders index[0m
  when viewing calendar show page
[32m    renders successfully[0m

BetterTogether::Address
[32m  exists[0m

BetterTogether::EventReminderNotifier
[32m  includes unread notification count in message[0m
[32m  includes event name in title[0m
[32m  defaults reminder type when not provided[0m
[32m  sets reminder type from params[0m

Community Invitation Token Access
  when invitation token is invalid
[32m    denies access with non-existent invitation token[0m
[32m    denies access with expired invitation token[0m
  when accessing private platform community via invitation token
[32m    allows access to community with valid invitation token[0m
[32m    denies access without invitation token on private platform[0m
[32m    stores invitation token in session for platform privacy bypass[0m

Hubs
  GET /index
[32m    returns http success[0m

BetterTogether::NavigationItem
  ActiveRecord associations
[32m    is expected to belong to parent class_name => NavigationItem optional: true[0m
[32m    is expected to have many children class_name => NavigationItem dependent => destroy[0m
[32m    is expected to belong to navigation_area required:[0m
  ActiveModel validations
[32m    is expected to validate that :position looks like an integer greater than or equal to 0[0m
[32m    is expected to allow :url to be â€¹""â€º[0m
[32m    is expected to allow :url to be â€¹"#"â€º[0m
[32m    is expected to allow :url to be â€¹"http://example.com"â€º[0m
[32m    is expected to validate that :item_type is either â€¹"link"â€º, â€¹"dropdown"â€º, or â€¹"separator"â€º[0m
[32m    is expected to validate that the length of :title is at most 255[0m
[32m    is expected to validate that :title cannot be empty/falsy[0m
  Methods
    #dropdown?
      when item type is not dropdown
[32m        returns false[0m
      when item type is dropdown
[32m        returns true[0m
    #child?
      when navigation item has no parent
[32m        returns false[0m
      when navigation item has a parent
[32m        returns true[0m
    #url
      when linkable is not present
        and url is set
[32m          returns the set url[0m
        and url is not set
[32m          returns default url (#)[0m
      when linkable is present
[32m        returns the url of the linkable object[0m
  Scopes
    .top_level
[32m      returns only top-level navigation items[0m
    .visible
[32m      returns only visible navigation items[0m
  Attributes
[32m    is expected to respond to #position[0m
[32m    is expected to respond to #url[0m
[32m    is expected to respond to #slug[0m
[32m    is expected to respond to #icon[0m
[32m    is expected to respond to #item_type[0m
[32m    is expected to respond to #visible[0m
[32m    is expected to respond to #title[0m
[32m    is expected to respond to #linkable_id[0m
[32m    is expected to respond to #protected[0m
[32m    is expected to respond to #linkable_type[0m
  Factory
[32m    has a valid factory[0m

BetterTogether::EventInvitationPolicy
  #destroy?
    with accepted event invitation
[32m      does not allow destroying[0m
    with pending event invitation
[32m      allows destroying[0m
  #resend?
    with pending event invitation
[32m      allows resending[0m
    with declined event invitation
[32m      allows resending[0m
    when user is not an event organizer
[32m      does not allow resending[0m
    with accepted event invitation
[32m      does not allow resending[0m
  #create?
    when user is not an event organizer
[32m      does not allow creating[0m
    when user is an event organizer
[32m      allows creating[0m

BetterTogether::Metrics::LinkCheckerReportSchedulerJob
[32m  runs without error[0m

BetterTogether::ConversationsChannel
[32m  streams for the conversation on subscribe[0m
[32m  does not raise on unsubscribe[0m

Setup Wizard completion
[32m  redirects to the success path with notice preserved[0m

BetterTogether::PlatformInvitationsController
  POST #create
    with invalid attributes
[32m      does not create an invitation[0m
[32m      renders the index template with errors[0m
    with valid attributes
[32m      redirects to platform show page[0m
[32m      creates a new invitation[0m
[32m      sets success flash message[0m
  DELETE #destroy
[32m    sets success flash message[0m
[32m    redirects to platform invitations index[0m
[32m    deletes the invitation[0m
  PATCH #resend
[32m    queues the mailer job[0m
[32m    redirects to platform invitations index[0m
[32m    sets success flash message[0m
  GET #index
    when user is authorized
[32m      returns http success[0m
[32m      includes proper associations for optimal loading[0m
[32m      assigns @platform[0m
[32m      assigns @platform_invitations with all platform invitations[0m
      with pagination
[32m        supports page parameter[0m
[32m        paginates results[0m
      with sorting
[32m        sorts by email when specified[0m
[32m        sorts by created_at when specified[0m
      with filtering
[32m        filters by status when provided[0m
      with search
[32m        searches by email when provided[0m
    when not authenticated
[32m      redirects to sign in[0m

BetterTogether::Event
  scopes
    .draft
[32m      returns events without starts_at[0m
    .upcoming
[32m      returns events starting in the future[0m
    .scheduled
[32m      returns events with starts_at[0m
    .past
[32m      returns events that have started[0m
  callbacks
    #send_update_notifications
[32m      enqueues notification job when conditions are met[0m
[32m      does not notify when no attendees[0m
    #schedule_reminder_notifications
[32m      schedules reminder job after starts_at update[0m
[32m      enqueues reminder job when conditions are met[0m
[32m      does not schedule for draft events[0m
  instance methods
    #host_community
      when no host community exists
[32m        returns nil when no host community exists[0m
      when host community exists
[32m        returns the host community[0m
[32m        caches the host community[0m
    #requires_reminder_scheduling?
[32m      returns false for events without attendees[0m
[32m      returns true for upcoming events with attendees[0m
[32m      returns false for draft events[0m
    #significant_changes_for_notifications
[32m      excludes non-significant changes[0m
[32m      detects significant attributes in list[0m
    #upcoming?
[32m      returns true for future events[0m
[32m      returns false for past events[0m
[32m      returns false for draft events[0m
    event hosts
[32m      defaults its host to its creator[0m
    #draft?
[32m      returns false when starts_at is present[0m
[32m      returns true when starts_at is nil[0m
    #scheduled?
[32m      returns false when starts_at is nil[0m
[32m      returns true when starts_at is present[0m
    #duration_in_hours
      when ends_at is not present
[32m        returns nil[0m
      when both starts_at and ends_at are present
[32m        calculates duration in hours[0m
    #location?
[32m      returns false when location is not present[0m
[32m      returns true when location is present[0m
    #past?
[32m      returns false for upcoming events[0m
[32m      returns false for draft events[0m
[32m      returns true for past events[0m
  delegation
[32m    delegates location_display_name to location[0m
[32m    delegates location_geocoding_string to location[0m
    when location is not present
[32m      returns nil for location_geocoding_string[0m
[32m      returns nil for location_display_name[0m
  class methods
    .permitted_attributes
[32m      includes nested location attributes[0m
[32m      includes standard attributes[0m
  validations
[32m    is expected to validate that :name cannot be empty/falsy[0m
    when ends_at is present
[32m      is valid when ends_at is after starts_at[0m
[32m      requires ends_at to be after starts_at[0m
    registration_url validation
[32m      rejects invalid URLs[0m
[32m      allows blank URLs[0m
[32m      allows valid http/https URLs[0m
  associations
[32m    is expected to have many event_attendances dependent => destroy[0m
[32m    is expected to have one location class_name => Geography::LocatableLocation[0m
[32m    is expected to have many attendees through event_attendances source => person[0m
[32m    is expected to accepts_nested_attributes_for :location[0m

files/index.html.erb
[32m  works[0m

BetterTogether::Metrics::TrackShareJob
[32m  exists[0m

BetterTogether::Joatu::Agreement
  status transitions
[32m    prevents rejecting after accepted or already rejected[0m
[32m    prevents changing from accepted to pending[0m
[32m    prevents rejecting when either side is already closed[0m
[32m    prevents accepting when either side is already closed[0m
[32m    enforces only one accepted agreement per offer and per request[0m
[32m    starts pending[0m

BetterTogether::UploadsHelper
[32m  exists[0m

BetterTogether::NavigationItemsController
  GET/PUT/DELETE on a navigation item
[32m    shows the item[0m
[32m    destroys and redirects[0m
[32m    updates with valid params then redirects and applies changes[0m
[32m    renders edit on invalid params (422)[0m
  GET /:locale/.../navigation_areas/:navigation_area_id/navigation_items
[32m    returns ok for index[0m
  POST /:locale/.../navigation_areas/:navigation_area_id/navigation_items
[32m    creates a navigation item and redirects (HTML), persisting permitted fields[0m
[32m    renders errors on invalid params[0m

BetterTogether::SearchController
[32m  renders search results page[0m

BetterTogether::Categorization
[32m  exists[0m

User Registration
[32m  User registers successfully[0m

BetterTogether::Geography::RegionsController
  GET /:locale/.../host/geography/regions/:id
[32m    renders show[0m
  GET /:locale/.../host/geography/regions
[32m    renders index[0m

BetterTogether::Invitation
  duplicate invitation prevention
    with accepted invitation
[32m      prevents creating duplicate invitation[0m
    with declined invitation
[32m      allows creating invitation with force_resend[0m
[32m      prevents creating duplicate invitation without force_resend[0m
    with pending invitation
[32m      prevents creating duplicate invitation[0m

BetterTogether::Geography::State
[32m  exists[0m

Conversation client-side validation
[32m  prevents submission and shows client-side validation when first message is empty[0m

BetterTogether::NavigationArea
  Factory
[32m    has a valid factory[0m
  ActiveModel validations
[32m    is expected to validate that :name cannot be empty/falsy[0m
[32m    is expected to validate that the length of :style is at most 255[0m
  Attributes
[32m    is expected to respond to #visible[0m
[32m    is expected to respond to #navigable_type[0m
[32m    is expected to respond to #navigable_id[0m
[32m    is expected to respond to #name[0m
[32m    is expected to respond to #style[0m
[32m    is expected to respond to #slug[0m
[32m    is expected to respond to #protected[0m
  Scopes
    .visible
[32m      returns only visible navigation areas[0m
  ActiveRecord associations
[32m    is expected to belong to navigable optional: true[0m
[32m    is expected to have many navigation_items dependent => destroy[0m

BetterTogether::Post
[32m  has a valid factory[0m
[32m  validates presence of title and content[0m
  #to_s
[32m    returns the title[0m
  behaves like an authorable model
[32m    has identity in its ancestor tree[0m
    ActiveRecord associations
[32m      is expected to have many authorships[0m
[32m      is expected to have many authors through authorships[0m
  after_create #add_creator_as_author
[32m    creates an authorship for the creator_id[0m

BetterTogether::Geography::Region
[32m  exists[0m

Event Invitations
  accepting via token
[32m    marks accepted and creates attendance[0m
  token edge cases
[32m    returns not found for invalid token[0m
[32m    returns not found for expired token[0m
  available people endpoint
[32m    returns people who can be invited, excluding already invited ones[0m
  resend throttling
[32m    does not update last_sent within 15 minutes[0m
  creating an event invitation
[32m    uses person locale and email when inviting existing user[0m
[32m    creates a pending invitation and sends notifications[0m
  declining via token
[32m    marks declined[0m

BetterTogether::Infrastructure::Floor
  ActiveModel validations
[32m    is expected to validate that :level looks like an integer[0m
[32m    is expected to validate that :name cannot be empty/falsy[0m
[32m    is expected to validate that :level cannot be empty/falsy[0m
  Factory
[32m    has a valid factory[0m
[32m    creates a floor with rooms[0m
  Attributes
[32m    is expected to respond to #name[0m
[32m    is expected to respond to #level[0m
[32m    is expected to respond to #description[0m
  Methods
    #ensure_room
[32m      builds a room if none exist[0m
    #to_s
[32m      returns the name as a string representation[0m
  ActiveRecord associations
[32m    is expected to belong to building class_name => BetterTogether::Infrastructure::Building required:[0m
[32m    is expected to have many rooms class_name => BetterTogether::Infrastructure::Room dependent => destroy[0m

BetterTogether::ConversationsHelper
[32m  exists[0m

BetterTogether::EventInvitation
  enhanced scopes
    .for_existing_users
[32m      returns only invitations with an invitee person[0m
    .for_email_addresses
[32m      returns only invitations with an email address but no invitee[0m
  enhanced URL generation
[32m    includes proper locale in generated URLs[0m
[32m    generates URLs that link directly to the event with invitation token[0m
  token generation
[32m    does not overwrite existing tokens[0m
[32m    automatically generates a token before validation[0m
  enhanced acceptance flow
    #after_accept!
[32m      handles missing event creator gracefully[0m
[32m      creates event attendance with going status[0m
[32m      does not create duplicate community memberships[0m
[32m      handles missing community gracefully[0m
    #accept!
[32m      sets status to accepted and calls after_accept![0m
    #decline!
[32m      sets status to declined[0m
  enhanced validations
    invitation uniqueness
[32m      prevents duplicate email invitations for the same event[0m
[32m      prevents duplicate person invitations for the same event[0m
[32m      allows duplicate invitations if previous one was declined[0m
[32m      allows same person to be invited to different events[0m
    invitee presence validation
[32m      accepts invitation with invitee_email only[0m
[32m      accepts invitation with invitee only[0m
[32m      requires either invitee or invitee_email[0m
  locale handling
[32m    validates locale is in available locales[0m
[32m    accepts valid locales[0m
[32m    requires locale to be present[0m
  invitation type helpers
    unknown invitation type
[32m      identifies as unknown when both are nil[0m
    person invitation
[32m      correctly identifies as person invitation[0m
    email invitation
[32m      correctly identifies as email invitation[0m

BetterTogether::Metrics::LinkCheckerReportsController
  GET /:locale/.../metrics/link_checker_reports
[32m    renders index[0m
[32m    renders new[0m
  POST /:locale/.../metrics/link_checker_reports
[32m    follows the redirect and renders ok[0m
[32m    creates a report and redirects with valid params[0m
  GET /:locale/.../metrics/link_checker_reports/:id/download
[32m    enqueues TrackDownloadJob when file is attached[0m
[32m    sends the file when attached[0m

BetterTogether::Geography::ContinentsHelper
[32m  exists[0m

BetterTogether::NavigationItem
  title fallbacks
[32m    prefers linkable title when set[0m
[32m    falls back to linkable translation for a missing nav translation[0m
[32m    returns blank when nav item title blank and no linkable[0m
[32m    returns nav item translation when present[0m
[32m    falls back to linkable title when nav item title blank and linkable present[0m
[32m    returns translation for requested locale when available[0m

Event edit preserves data
[32m  submitting the edit form without changes keeps the event unchanged[0m
    
1st Try error in ./spec/features/events/edit_preserve_spec.rb:13:
Couldn't find BetterTogether::Event with 'id'="search"
    
RSpec::Rebound: 2nd try ./spec/features/events/edit_preserve_spec.rb:13

BetterTogether::CommunitiesHelper
[32m  exists[0m

BetterTogether::Identity
  BetterTogether::TestClass
    behaves like an identity
[32m      has identity in its ancestor tree[0m
      ActiveRecord associations
[32m        is expected to have many identifications[0m

BetterTogether::Conversations
  PATCH /conversations/:id
    as a regular member
[32m      does not add non-permitted participants on update[0m
[32m      shows an error when update attempts to add only non-permitted participants[0m
  GET /conversations/:id
    as a non-participant
[32m      returns not found[0m
  GET /conversations/new
    as a platform manager
[32m      lists all people as available participants[0m
    as a regular member
[32m      lists platform managers and opted-in members, but excludes non-opted members[0m
  POST /conversations
    as a regular member
[32m      shows an error when only non-permitted participants are submitted[0m
[32m      creates conversation with permitted participants (opted-in) and excludes non-permitted[0m

BetterTogether::Metrics::InternalLinkCheckerJob
[32m  updates link status on success[0m

BetterTogether::Page
  Scopes
    .by_publication_date
[32m      orders pages by published date descending[0m
    .published
[32m      returns only published pages[0m
    .privacy_public
[32m      returns only public pages[0m
  Factory
[32m    has a valid factory[0m
  Methods
    #published?
[32m      returns false if the page is not published[0m
[32m      returns true if the page is published[0m
    #url
[32m      returns the full URL of the page[0m
    #to_s
[32m      returns the title[0m
  ActiveModel validations
[32m    is expected to validate that :title cannot be empty/falsy[0m
[32m    is expected to validate that :privacy cannot be empty/falsy[0m
  Attributes
[32m    is expected to respond to #published_at[0m
[32m    is expected to respond to #meta_description[0m
[32m    is expected to respond to #slug[0m
[32m    is expected to respond to #content[0m
[32m    is expected to respond to #layout[0m
[32m    is expected to respond to #template[0m
[32m    is expected to respond to #privacy[0m
[32m    is expected to respond to #keywords[0m
[32m    is expected to respond to #title[0m
[32m    is expected to respond to #protected[0m

BetterTogether::Wizard
  Factory
[32m    has a valid factory[0m
  ActiveModel validations
[32m    is expected to validate that :name cannot be empty/falsy[0m
[32m    is expected to validate that :max_completions looks like an integer greater than or equal to 0[0m
[32m    is expected to validate that :current_completions looks like an integer greater than or equal to 0[0m
  Attributes
[32m    is expected to respond to #max_completions[0m
[32m    is expected to respond to #protected[0m
[32m    is expected to respond to #identifier[0m
[32m    is expected to respond to #first_completed_at[0m
[32m    is expected to respond to #current_completions[0m
[32m    is expected to respond to #success_message[0m
[32m    is expected to respond to #slug[0m
[32m    is expected to respond to #description[0m
[32m    is expected to respond to #last_completed_at[0m
[32m    is expected to respond to #success_path[0m
[32m    is expected to respond to #name[0m
  Methods
    #mark_completed
      when current completions is less than max completions
[32m        increases current completions and updates completed at[0m
      when current completions is equal to max completions
[32m        does not change current completions[0m
    #limited_completions?
      when max_completions is zero
[32m        returns false[0m
      when max_completions is positive
[32m        returns true[0m
    #completed?
      when all wizard steps are completed
[32m        returns true[0m
      when not all wizard steps are completed
[32m        returns false[0m
  ActiveRecord associations
[32m    is expected to have many wizard_steps dependent => destroy[0m
[32m    is expected to have many wizard_step_definitions dependent => destroy[0m

managing agreements
[32m  agreement appears on index[0m

BetterTogether::CallForInterest
[32m  exists[0m

BetterTogether::Category
[32m  exists[0m

BetterTogether::ResourcePermissionsController
  GET /:locale/.../host/permissions
[32m    renders show for a permission[0m
[32m    renders index[0m

BetterTogether::EventReminderJob
  error handling
[32m    handles invalid event IDs gracefully[0m
[32m    handles missing events gracefully[0m
  #perform
    with valid event
[32m      sends reminders to all going attendees[0m
[32m      accepts reminder type parameter[0m
    with invalid event
[32m      handles missing event gracefully[0m
[32m      handles event without start time[0m
    when event has no attendees
[32m      completes without sending notifications[0m
  queue configuration
[32m    uses the notifications queue[0m

BetterTogether::PersonCommunityMembership
  ActiveRecord associations
[32m    is expected to belong to role required:[0m
[32m    is expected to belong to joinable required:[0m
[32m    is expected to belong to member class_name => BetterTogether::Person required:[0m
  Factory
[32m    has a valid factory[0m
  Attributes
[32m    is expected to respond to #joinable_id[0m
[32m    is expected to respond to #member_id[0m
[32m    is expected to respond to #role_id[0m

BetterTogether::Person
  message opt-in preference
[32m    defaults to false and can be toggled to true[0m

BetterTogether::ChecklistItem
[32m  assigns incremental position scoped by checklist and parent[0m

Checklist item creation appends to bottom
[32m  creates a new checklist item and it appears at the bottom after refresh[0m

files/download.html.erb
[32m  works[0m

Nested Checklist Items
  when creating a nested child
[32m    sets the parent id on the created child[0m
[32m    creates a child item under a parent[0m
  when creating a localized child
[32m    creates a localized child record[0m
[32m    stores the localized label on the created child[0m
  when reordering siblings
[32m    responds with no content[0m
[32m    does not affect top-level item position[0m
[32m    moves the first sibling to position 1[0m
[32m    moves the second sibling to position 0[0m

BetterTogether::Conversation
  #add_participant_safe
[32m    adds a participant when not present[0m
[32m    retries once on ActiveRecord::StaleObjectError and succeeds[0m

Geography::Maps
  GET /index
[32m    works[0m

BetterTogether::Agreement
  factory
[32m    is valid[0m
  protected records
[32m    cannot be destroyed when protected[0m
  associations
[32m    is expected to belong to creator class_name => BetterTogether::Person optional: true[0m
[32m    is expected to have many agreement_terms class_name => BetterTogether::AgreementTerm[0m
  callbacks
[32m    generates a slug from the title[0m
  validations
[32m    requires a valid privacy value[0m
[32m    is expected to validate that :protected is either â€¹trueâ€º or â€¹falseâ€º[0m
[32m    requires a unique identifier[0m

BetterTogether::JoatuMailer
  new_match
[32m    renders the headers[0m
  agreement_created
[32m    renders the headers[0m
[32m    sends the email[0m
[32m    sends the agreement created email to the recipient[0m
[32m    renders the body[0m

BetterTogether::EventInvitation
  #decline!
[32m    changes status to declined[0m
  #after_accept!
[32m    completes the invitation acceptance process[0m
  Factory
[32m    has a valid factory[0m
  #event
[32m    returns the invitable event[0m
  ActiveRecord associations
[32m    is expected to belong to inviter required: true[0m
[32m    is expected to belong to role optional: true[0m
[32m    is expected to belong to invitee optional: true[0m
[32m    is expected to belong to invitable required: true[0m
  Validations
[32m    requires either invitee or invitee_email when both are blank[0m
[32m    is expected to validate that :locale is either â€¹"en"â€º, â€¹"fr"â€º, â€¹"es"â€º, or â€¹"uk"â€º[0m
[32m    is expected to validate that :locale cannot be empty/falsy[0m
    invitee uniqueness for event
[32m      prevents duplicate invitations to the same event[0m
  #url_for_review
[32m    returns the review URL for the invitation[0m

BetterTogether::Metrics::PageViewReportsController
  POST /:locale/.../metrics/page_view_reports
[32m    creates a report and redirects with valid params[0m
  GET /:locale/.../metrics/page_view_reports
[32m    renders index[0m
[32m    renders new[0m

Joatu matchmaking
[32m  matches offers with requests and finalizes agreement[0m

BetterTogether::Metrics::RichTextLink
[33m  add some examples to (or delete) /community-engine/spec/models/better_together/metrics/rich_text_link_spec.rb (PENDING: Not yet implemented)[0m

BetterTogether::Joatu::RequestPolicy
  #show?
[32m    is expected to equal false[0m
[32m    is expected to equal true[0m
  Scope
    authenticated user
[32m      includes all requests[0m
    guest
[32m      returns none[0m
  #destroy?
[32m    denies other users[0m
[32m    allows a manager[0m
[32m    allows the creator[0m
  #index?
[32m    is expected to equal false[0m
[32m    is expected to equal true[0m
  #create?
[32m    is expected to equal true[0m
[32m    is expected to equal false[0m
  #update?
[32m    allows the creator[0m
[32m    denies other users[0m
[32m    allows a manager[0m

BetterTogether::EventInvitation
  enhanced URL generation
[32m    generates URLs that link directly to the event with invitation token[0m
[32m    includes proper locale in generated URLs[0m
  enhanced acceptance flow
    #accept!
[32m      sets status to accepted and calls after_accept![0m
    #decline!
[32m      sets status to declined[0m
    #after_accept!
[32m      creates event attendance with going status[0m
[32m      handles missing event creator gracefully[0m
[32m      handles missing community gracefully[0m
[32m      does not create duplicate community memberships[0m

File
[32m  exists[0m

BetterTogether::ChecklistsController
  GET /checklists/:id
[32m    shows a public checklist[0m
  CRUD actions as platform manager
[32m    destroys an unprotected checklist[0m
[32m    creates a checklist[0m
[32m    updates a checklist[0m
  authorization for update/destroy as creator
[32m    allows creator to update their checklist[0m

BetterTogether::EventReminderSchedulerJob
  #reminder_intervals
[32m    defines standard reminder intervals[0m
  #schedule_future_reminder?
[32m    does not schedule jobs for past times[0m
[32m    schedules jobs for future times[0m
  #perform
[32m    schedules 1-hour reminder[0m
[32m    schedules start-time reminder[0m
[32m    schedules 24-hour reminder[0m
[32m    schedules reminder notifications at appropriate intervals[0m
    when event does not exist
[32m      completes without scheduling reminders[0m
    when event starts soon
[32m      does not schedule past reminders[0m
[32m      only schedules future reminders[0m
    when event is in the past
[32m      does not schedule any reminders[0m
    when event is draft
[32m      does not schedule any reminders[0m
    when event has no attendees
[32m      does not schedule any reminders[0m
  retry and error handling
[32m    discards non-retryable errors[0m
[32m    has retry configuration[0m
  queue configuration
[32m    uses the notifications queue[0m

BetterTogether::Metrics::PageViewReportsController download
[32m  downloads an attached report file[0m

Example Automatic Configuration
  with platform manager role
[32m    automatically authenticates from context description[0m
  without host platform setup
[32m    skips automatic host platform configuration[0m
  with authenticated user
[32m    automatically authenticates as regular user[0m
  without authentication
[32m    remains unauthenticated[0m
  with explicit platform manager tag
[32m    automatically authenticates as platform manager[0m

BetterTogether::NotificationReadable
  #mark_notifications_read_for_record_id
[32m    marks unread notifications tied to the event record as read[0m
  #mark_match_notifications_read_for
[32m    marks unread match notifications for the given record as read[0m

notification badge
  with platform manager role
[32m    updates badge and title based on unread count[0m

BetterTogether::ConversationParticipant
[32m  exists[0m

BetterTogether::Content::PageBlock
[32m  exists[0m

BetterTogether::Joatu::MatchNotifier
[32m  does not create duplicate unread notifications for the same pair and recipient[0m

Community Invitation Review
  when accessing community with valid invitation token
[32m    displays the invitation review section[0m
[32m    displays the pending status badge[0m
  when accessing community without invitation token
[32m    does not display the invitation review section[0m

BetterTogether::CallsForInterestHelper
[32m  exists[0m

BetterTogether::Metrics::TrackDownloadJob
[32m  exists[0m

BetterTogether::Authorship
  notifications on remove
[32m    notifies when someone else removes the author[0m
[32m    does not notify when current_person removes themselves[0m

sending a message
  when message is sent
[32m    appears in the chat window[0m

BetterTogether::User
  Factory
[32m    has a valid factory[0m
  ActiveModel validations
[32m    is expected to validate that :email is case-insensitively unique[0m
[32m    is expected to validate that :email cannot be empty/falsy[0m
[32m    is expected to validate that :password cannot be empty/falsy[0m
  Methods
[32m    is expected to respond to #person_attributes=[0m
[32m    is expected to respond to #build_person[0m
    #build_person
[32m      builds a new person identification and person[0m
    #person_attributes=
      when person exists
[32m        updates the existing person[0m
      when person does not exist
[32m        builds a new person[0m
  Attributes
[32m    is expected to respond to #encrypted_password[0m
[32m    is expected to respond to #email[0m
[32m    is expected to respond to #slug[0m
  ActiveRecord associations
[32m    is expected to have one person through person_identification[0m
[32m    is expected to accepts_nested_attributes_for :person[0m
[32m    is expected to have one person_identification[0m

Invitation Resend UI
  declined invitation resend button
[32m    shows special resend button for declined invitations[0m
[32m    shows confirmation dialog when clicking resend to declined[0m
  pending invitation resend button
[32m    shows normal resend button for pending invitations[0m

BetterTogether::EventsController
  GET /events/:id
    as regular user
[32m      does not show attendees tab to non-organizer[0m
    as platform manager
[32m      shows attendees tab to organizers[0m
  RSVP actions
[32m    prevents RSVP creation without login[0m
[32m    requires login[0m
    when logged in as platform manager
[32m      cancels RSVP[0m
[32m      updates RSVP to going[0m
[32m      creates RSVP as interested[0m
      with draft events
[32m        prevents RSVP for draft events[0m
[32m        prevents going RSVP for draft events[0m
  creating events with different location types
    as platform manager
[32m      creates an event with a Building location[0m
[32m      creates an event with an Address location[0m
[32m      creates a draft event with no location assigned[0m
[32m      creates an event with a simple (name) location[0m
  GET /events/:id.ics
[32m    includes calendar start header[0m
[32m    includes unique event identifier[0m
[32m    returns correct content type[0m
[32m    returns successful response[0m
[32m    includes calendar end header[0m
[32m    includes event URL[0m
[32m    includes event summary[0m

BetterTogether::EmailAddress
[32m  exists[0m

BetterTogether::PlatformsController
  GET /:locale/.../host/platforms
[32m    renders show for host platform[0m
[32m    renders index[0m
  PATCH /:locale/.../host/platforms/:id
[32m    updates settings and redirects[0m
    when updating CSS block
      when platform has existing CSS block
[32m        handles CSS with special characters and quotes[0m
[32m        updates existing CSS block content[0m
[32m        clears CSS content when empty string submitted[0m
[32m        preserves CSS block ID when updating[0m
      when CSS block update fails validation
[32m        renders edit form with unprocessable_content status[0m
      when platform has no existing CSS block
[32m        creates CSS block with complex real-world CSS[0m
[32m        creates a new CSS block with content[0m

Conversation message protection
[32m  prevents a user from altering another user's message via conversation update[0m

PersonChecklistItems JSON
[32m  accepts JSON POST with headers and returns json[0m

BetterTogether::Metrics::ExternalLinkCheckerJob
[32m  updates link status on success[0m

BetterTogether::Joatu::CategoryOptions
[32m  returns [name, id] pairs sorted by translated name with mobility fallbacks[0m

BetterTogether::Ai::Log::Translation
[32m  exists[0m

BetterTogether::Joatu::Offer
[32m  is invalid without target_type when target_id is set[0m
[32m  is invalid without categories[0m
[32m  is invalid without a creator[0m
[32m  is valid without a target[0m
[32m  is valid with a target[0m
[32m  is valid with only a target_type[0m
  translations validation side-effects
[32m    does not instantiate blank string translations for other locales when assigning name_en and validating[0m

BetterTogether::AgreementTerm
  callbacks
[32m    assigns sequential positions within an agreement[0m
  validations
[32m    is expected to validate that :position looks like an integer greater than or equal to 0[0m
[32m    requires a unique identifier[0m
[32m    is expected to validate that :protected is either â€¹trueâ€º or â€¹falseâ€º[0m
  factory
[32m    is valid[0m
  protected records
[32m    cannot be destroyed when protected[0m
  associations
[32m    is expected to belong to agreement class_name => BetterTogether::Agreement required:[0m

BetterTogether::Metrics::TrackLinkClickJob
[32m  exists[0m

BetterTogether::Metrics::TrackSearchQueryJob
[32m  stores provided attributes[0m
[32m  creates a search query metric[0m

Create Conversation with initial message
[32m  creates conversation and nested message with sender set[0m

BetterTogether::Geography::GeospatialSpace
[32m  exists[0m

BetterTogether::Metrics::PageViewReport
[32m  exists[0m

BetterTogether::PagePolicy
  #show?
    for published public pages
      anyone
[32m        is expected to equal true[0m
    for private or unpublished pages
      manager
[32m        is expected to equal true[0m
      normal user
[32m        is expected to equal false[0m
      author
[32m        is expected to equal true[0m
  #update?
    manager
[32m      is expected to equal true[0m
    normal user
[32m      is expected to equal false[0m
    author
[32m      is expected to equal true[0m
  Scope
    author
[32m      includes authored and published public pages[0m
    normal user
[32m      includes published public pages and nothing else is guaranteed[0m
    manager
[32m      includes all pages[0m
    guest
[32m      includes published public pages and nothing else is guaranteed[0m

BetterTogether::CommunitiesController
  GET /:locale/.../host/communities
[32m    renders show for a community[0m
[32m    renders index[0m
  PATCH /:locale/communities/:id
[32m    updates and redirects[0m

BetterTogether::WebsiteLink
[32m  exists[0m

Invitation-based User Registration
  Platform Invitation Registration
[32m    creates user with person, accepts invitation, and assigns platform role[0m
  Multiple invitation types in session
[32m    accepts all invitations for the same email when multiple codes provided[0m
  Registration without invitation
[32m    still creates user with person record[0m
  Failed registration scenarios
[32m    does not accept invitation if user creation fails[0m
  Event Invitation Registration
[32m    creates user with person, accepts event invitation, and creates event attendance[0m
  Community Invitation Registration
[32m    handles invitation with existing invitee person[0m
[32m    creates user with person and accepts invitation[0m

BetterTogether::Authorship
  notifications on add
[32m    notifies when current_person adds someone else[0m
[32m    does not notify when current_person adds themselves[0m

BetterTogether::FriendlySlug
  BetterTogether::TestClass
    behaves like a friendly slugged record
      extends ::FriendlyId
[32m        is expected to respond to #friendly_id[0m
[32m        is expected to respond to #slugged[0m

BetterTogether::AgreementParticipant
[32m  has a valid factory[0m
[32m  is expected to belong to person class_name => BetterTogether::Person required:[0m
[32m  is expected to belong to agreement class_name => BetterTogether::Agreement required:[0m

accepting a platform invitation
[32m  by signing up a new user[0m

BetterTogether::Geography::SettlementsHelper
[32m  exists[0m

BetterTogether::CommunityInvitation
  #decline!
[32m    changes status to declined[0m
  Validations
[32m    is expected to validate that :locale is either â€¹"en"â€º, â€¹"fr"â€º, â€¹"es"â€º, or â€¹"uk"â€º[0m
[32m    is expected to validate that :locale cannot be empty/falsy[0m
    invitee presence validation
[32m      requires either invitee or invitee_email[0m
  Factory
[32m    has a valid factory[0m
  #accept!
[32m    changes status to accepted[0m
  #invitation_type
[32m    returns :person for person invitations[0m
[32m    returns :email for email invitations[0m
  #community
[32m    returns the invitable community[0m
  ActiveRecord associations
[32m    is expected to belong to invitable required: true[0m
[32m    is expected to belong to role optional: true[0m
[32m    is expected to belong to inviter required: true[0m
[32m    is expected to belong to invitee optional: true[0m

BetterTogether::PersonBlock
[32m  does not allow blocking platform managers[0m
[32m  allows a person to block another person[0m

BetterTogether::NotificationsHelper
  fragment cache methods
    #notification_type_fragment_cache_key
[32m      builds type-specific cache key[0m
[32m      uses class name when type is nil[0m
    #expire_notification_type_fragments
[32m      deletes cache entries matching notification type pattern[0m
    #should_cache_notification?
[32m      returns false when notification does not respond to cache_key_with_version[0m
[32m      returns false when record is not present[0m
[32m      returns true for valid notification[0m
[32m      returns false when notification is not present[0m
    #expire_notification_fragments
[32m      expires all related fragment caches[0m
    #notification_fragment_cache_key
[32m      handles notification without event cache key[0m
[32m      handles notification without record cache key[0m
[32m      builds cache key with notification, record, event and locale[0m
  #unread_notification_counter
[32m    renders badge html when unread notifications present[0m
[32m    returns nil when there are no unread notifications[0m
  #recent_notifications
[32m    returns recent notifications ordered by created_at desc[0m
  #unread_notification_count
[32m    returns nil when there is no current person[0m
[32m    returns number of unread notifications for current person[0m
  #unread_notifications?
[32m    returns false when there are no unread notifications[0m
[32m    returns true when unread notifications exist[0m

BetterTogether::EventReminderJob
  job scheduling
[32m    can be enqueued for future execution[0m
  #perform
[32m    delivers event reminder notifications to attendees[0m
    when event does not exist
[32m      completes without sending notifications[0m
    when event is in the past
[32m      still sends notifications (for missed events)[0m
    when event has no attendees
[32m      completes without sending notifications[0m
  queue and retry configuration
[32m    has discard configuration for non-retryable errors[0m
[32m    uses the notifications queue[0m
[32m    has retry configuration[0m

BetterTogether::Joatu::Requests
  GET /show
[32m    returns success[0m
  POST /create
[32m    creates a request[0m
  routing
[32m    routes to #index[0m
  DELETE /destroy
[32m    destroys the request[0m
  GET /index
[32m    returns success[0m
  PATCH /update
[32m    updates the request[0m

BetterTogether::Joatu::ResponseLink
[32m  prevents creating a response link for a closed source[0m
[32m  marks open source as matched on create[0m

BetterTogether::Geography::RegionsHelper
[32m  exists[0m

BetterTogether::Metrics::SharesHelper
[32m  exists[0m

BetterTogether::EventInvitationsMailer
  #invite
    with valid invitation
[32m      includes invitation URL[0m
[32m      renders the body with event details[0m
[32m      renders the headers correctly[0m
      when invitation has inviter
[32m        includes inviter information[0m
      when event has starts_at time
[32m        includes formatted start time[0m
      when event has description with Action Text and Mobility translations
[32m        converts Action Text to plain text for email display[0m
[32m        includes description content in plain text format[0m
[32m        handles Action Text description correctly without errors[0m
      when event has location
[32m        includes location information[0m
      when event has no description
[32m        does not include description section[0m
    with invalid invitation
[32m      does not send email when invitee_email is blank[0m
    localization
[32m      uses invitation locale for email content[0m

BetterTogether::PersonChecklistItemsController
[32m  returns empty record when none exists and can create a completion[0m

BetterTogether::Role
  #description
[32m    is expected to respond to #description[0m
  #protected
[32m    is expected to respond to #protected[0m
  #name
[32m    is expected to respond to #name[0m
  #resource_type
[32m    is expected to respond to #resource_type[0m
  has a valid factory
[32m    is expected to be valid[0m
  #to_s
[32m    is expected to eq "Steve Emmerich"[0m
  behaves like has_id
[32m    has BetterTogetherID in its ancestor tree[0m
    callbacks
[32m      is expected to callback generate_id before validation[0m
  ActiveModel validations
[32m    is expected to validate that :name cannot be empty/falsy[0m
  .only_protected
[32m    is expected to respond to #only_protected[0m
[32m    scopes results to protected = true[0m
  #position
[32m    increments the max position when other roles exist[0m
[32m    is expected to respond to #position[0m

BetterTogether::UsersController
  GET /:locale/.../host/users
[32m    renders index[0m
[32m    renders show for the current user[0m

Person completes checklist
[33m  allows a person to complete all items and shows completion message (PENDING: Temporarily skipped with xit)[0m

creating a platform invitation
[32m  with valid inputs[0m

BetterTogether::EventCategory
[32m  exists[0m

BetterTogether::Joatu::AgreementNotifier
[32m  builds message with offer and request names[0m
[32m  notifies both offer and request creators when agreement is created[0m

BetterTogether::Infrastructure::Room
  Factory
[32m    has a valid factory[0m
  Attributes
[32m    is expected to respond to #description[0m
[32m    is expected to respond to #name[0m
  ActiveRecord associations
[32m    is expected to belong to floor class_name => BetterTogether::Infrastructure::Floor required:[0m
[32m    is expected to have one building class_name => BetterTogether::Infrastructure::Building through floor[0m
  Methods
    #to_s
[32m      returns the name as a string representation[0m
  ActiveModel validations
[32m    is expected to validate that :name cannot be empty/falsy[0m

BetterTogether::ChecklistItemsHelper
[32m  builds option title for a parent item with slug[0m
[32m  builds option title for a child item with depth prefix and slug[0m

BetterTogether::Joatu::Offers
  DELETE /destroy
[32m    destroys the offer[0m
  PATCH /update
[32m    updates the offer[0m
  GET /show
[32m    returns success[0m
  GET /index
[32m    returns success[0m
  routing
[32m    routes to #index[0m
  POST /create
[32m    creates an offer[0m

BetterTogether::EventsHelper
  #display_event_time
    when event spans multiple days with short duration
[32m      displays full start and end date times (ignores duration rules for multi-day)[0m
    when event spans into next year
[32m      displays both dates with their respective years[0m
    when event has no end time
[32m      returns formatted start time only[0m
    when event has no end time and is in a different year
[32m      returns formatted start time with year[0m
    when duration is over 5 hours on same day in different year
[32m      displays start and end times with year[0m
    when duration is exactly 5 hours on same day
[32m      displays start time with hours duration[0m
    when event has no start time
[32m      returns empty string[0m
    when event spans multiple days in different year
[32m      displays full start and end date times with year[0m
    when duration is under 1 hour and in different year
[32m      displays start time with year and minutes duration[0m
    when event spans multiple days
[32m      displays full start and end date times[0m
    when duration is over 5 hours on same day
[32m      displays start and end times[0m
    when duration is exactly 1 hour
[32m      displays start time with hour duration (singular)[0m
    when duration is between 1 and 5 hours on same day
[32m      displays start time with hours duration (plural)[0m
    when duration is under 1 hour
[32m      displays start time with minutes duration[0m
  #visible_event_hosts
[32m    handles events without event_hosts method[0m

Joatu offer and request forms
[32m  creating a request[0m
[32m  shows created offer[0m

BetterTogether::PeopleHelper
[32m  exists[0m

BetterTogether::EventInvitation
  enhanced scopes
    .for_email_addresses
[32m      returns only invitations with an email address but no invitee[0m
    .for_existing_users
[32m      returns only invitations with an invitee person[0m
  invitation type helpers
    person invitation
[32m      correctly identifies as person invitation[0m
    email invitation
[32m      correctly identifies as email invitation[0m
    unknown invitation type
[32m      identifies as unknown when both are nil[0m

Offers aggregated matches
[32m  shows Potential Matches for my offers with matching requests[0m

BetterTogether::JwtDenylist
[32m  exists[0m

Profile message prefill
[32m  preselects the person when visiting new conversation via profile message link[0m

BetterTogether::NotificationCacheManagement
  concern functionality
    #should_expire_caches?
[32m      returns true when created_at changes[0m
[32m      returns true when read_at changes[0m
[32m      returns true when updated_at changes[0m
[32m      returns false when nothing relevant changes[0m
    #expire_notification_caches
[32m      handles errors gracefully[0m
[32m      handles missing helper methods gracefully[0m
[32m      calls helper methods when available[0m
    #respond_to_cache_methods?
[32m      returns true when helper methods are available[0m
[32m      returns false when helper methods are not available[0m
[32m      returns false when helpers raise an error[0m

BetterTogether::Geography::RegionSettlement
[32m  exists[0m

Platform invitation request
[32m  visitor requests invite and sees matching offer[0m

BetterTogether::PeopleController
  GET /:locale/.../host/p/:id
[32m    renders edit[0m
[32m    renders show[0m
  PATCH /:locale/.../host/p/:id
[32m    updates name and redirects[0m

BetterTogether::Metrics::TrackLinkClickJob
  UTF-8 URL handling
[32m    handles UTF-8 page URLs[0m
[32m    creates LinkClick records for UTF-8 URLs without errors[0m

NotFoundHandler
  other resources
[32m    renders 404 for missing post[0m
  pages
[32m    renders promo page for root variants[0m
[32m    renders 404 for missing page[0m

BetterTogether::Metrics::LinkClickReportsController
  POST /:locale/.../metrics/link_click_reports
[32m    creates a report and redirects with valid params[0m
  GET /:locale/.../metrics/link_click_reports
[32m    renders index[0m
[32m    renders new[0m

BetterTogether::Joatu::Agreements
  routing
[32m    routes to #index[0m
  GET /show
[32m    returns success[0m
  PATCH /update
[32m    updates the agreement[0m
  GET /index
[32m    returns success[0m
  DELETE /destroy
[32m    destroys the agreement[0m
  POST /create
[32m    creates an agreement[0m

BetterTogether::PersonCommunityMembershipsController
  DELETE /:locale/.../host/communities/:community_id/person_community_memberships/:id
[32m    destroys a membership and redirects[0m
  POST /:locale/.../host/communities/:community_id/person_community_memberships
[32m    creates a membership and redirects when actor has update_community permission[0m

BetterTogether::Generators::InvitationGenerator
  with skip options
[32m    creates core files when views are skipped[0m
  basic file generation
[32m    creates the invitation mailer file[0m
[32m    creates the model spec file[0m
[32m    creates the invitation model file[0m
[32m    creates the invitation policy file[0m
[32m    creates the policy spec file[0m
[32m    generates mailer with correct class structure[0m
[32m    creates the invitation notifier file[0m
[32m    creates view files[0m
[32m    creates the mailer spec file[0m
[32m    generates model with correct class structure[0m
[32m    creates the invitation factory file[0m
[32m    generates factory with correct structure[0m
  migration generation
[33m    migration generation is pending Rails 8 migration_template API fix (PENDING: Rails 8 migration_template API requires updates)[0m

hub/index.html.erb
[32m  works[0m

BetterTogether::Comment
[32m  exists[0m

Translatable Attachments writer
[32m  uses the storage service upload when creating blobs (stubbed service)[0m
[32m  uploads IO-like objects via the writer[0m
[32m  replaces existing attachment and leaves old blob unattached (can be purged)[0m
[32m  attaches an ActiveStorage::Blob via the writer[0m
[32m  accepts named variants on the model reflection without raising[0m
[32m  purges and removes the attachment when assigning nil[0m

ReportPORO
  CSV generation and filename
[32m    builds a filename with stamps and extension[0m
[32m    creates a CSV with the expected rows[0m

BetterTogether::BlockFilterable
[32m  filters out posts from blocked people[0m

BetterTogether::ApplicationMailer
  default from address
[32m    is set correctly[0m

Invitation Resend
  PUT /communities/:community_id/invitations/:id/resend
    when invitation is declined
[32m      allows resending the invitation[0m
    when invitation is pending
[32m      allows resending the invitation[0m
    when invitation is accepted
[32m      does not allow resending the invitation[0m

BetterTogether::Geography::Settlement
[32m  exists[0m

BetterTogether::Joatu::Matchmaker
  .match
    target wildcard behavior
[32m      does not match when both have different non-nil target_id values[0m
[32m      matches when request has target_id and offer has nil (wildcard)[0m
[32m      matches when offer has target_id and request has nil (wildcard)[0m
    pair-specific response link exclusion
[32m      does not exclude an offer just because a different request linked to it[0m
[32m      excludes an offer only when a response link exists for that specific request->offer pair[0m

BetterTogether::Metrics::ReportMailer
  .link_checker_report
[32m    calls mail with the app from address[0m
[32m    builds attachments on the mailer instance[0m

BetterTogether::Metrics::LinkClick
  UTF-8 URL validation
[32m    handles URL encoding properly[0m
[32m    accepts UTF-8 encoded page URLs[0m
[32m    accepts UTF-8 encoded URLs[0m

BetterTogether::Metrics::SearchQueriesController
[32m  returns 422 for invalid params[0m
[32m  tracks a search query with valid params[0m

BetterTogether::Builder
  .clear_existing
[32m    raises when not implemented[0m
  .build
[32m    calls clear_existing and seed_data when clear: true[0m
[32m    calls seed_data without clear when clear: false[0m
  .seed_data
[32m    raises when not implemented[0m

BetterTogether::Report
[32m  requires a reason[0m
[32m  allows a person to report another person[0m

Debug Mode Functionality
  Security: preventing cache and indexing
[32m    allows normal caching when debug is disabled[0m
[32m    allows search engine indexing when debug is disabled[0m
[32m    prevents search engine indexing when debug is enabled[0m
[32m    prevents page caching when debug is enabled[0m
  Debug mode activation via parameter
[32m    clears debug mode when ?debug=false is passed[0m
[32m    enables debug mode when ?debug=true is passed[0m
[32m    sets expiration to 30 minutes from now[0m
[32m    clears debug mode when ?debug=anything is passed[0m
  Debug mode with immediate parameter override
[32m    disables debug mode immediately with parameter even with active session[0m
[32m    enables debug mode immediately with parameter even without session[0m
  Debug mode expiration
[32m    expires debug mode after 30 minutes[0m
[32m    does not expire before 30 minutes[0m
  Debug mode meta tags and headers
    when debug mode is enabled
[32m      includes cache-control meta tags[0m
[32m      sets noindex,nofollow robots meta tag[0m
[32m      sets no-cache HTTP headers[0m
[32m      includes stimulus-debug meta tag set to true[0m
    when debug mode is disabled
[32m      sets default robots meta tag[0m
[32m      includes stimulus-debug meta tag set to false[0m
[32m      does not include cache-control meta tags[0m
[32m      does not set no-cache HTTP headers[0m
  Helper method stimulus_debug_enabled?
[32m    returns true when debug parameter is present[0m
[32m    returns false when session has expired[0m
[32m    returns true when session is active and not expired[0m
[32m    returns false when no debug mode is active[0m
  Debug mode persistence across requests
[32m    persists debug mode across subsequent requests[0m
[32m    maintains debug mode for multiple page visits[0m

Checklist reorder UX
[32m  allows reordering items via move buttons (server-driven)[0m

BetterTogether::ContactDetail
[32m  exists[0m

BetterTogether::EventMailer
  #event_update
[32m    includes changed attributes information[0m
[32m    renders the headers[0m
[32m    renders the body with update information[0m
    with single changed attribute
[32m      renders singular update message[0m
    with multiple changed attributes
[32m      renders plural update message[0m
  configuration
[32m    uses configured from email[0m
[32m    includes organization branding[0m
  delivery methods
[32m    delivers event reminder mail[0m
[32m    delivers event update mail[0m
  #event_reminder
[32m    renders the headers[0m
[32m    renders the body with event details[0m
[32m    includes event timing information[0m
    when event has location
[32m      includes location information[0m
    when event has registration URL
[32m      includes registration link[0m
    when event has duration
[32m      includes duration information[0m
  localization
[32m    uses correct locale for body content[0m
[32m    uses correct locale for subject[0m

BetterTogether::Metrics::SharesController
[32m  creates a share for an allowed shareable type[0m
[32m  rejects disallowed shareable types via resolver (no record created)[0m

BetterTogether::EventAttendancePolicy
  #update?/#destroy?
[32m    denies other users from updating[0m
[32m    permits the owner[0m
[32m    allows owner to destroy their attendance[0m
[32m    denies other users from destroying[0m
  #create?
[32m    permits any logged in user[0m
[32m    denies guests[0m

BetterTogether::SocialMediaAccount
[32m  exists[0m

BetterTogether::PlatformInvitation
  Factory
[32m    has a valid factory[0m
  ActiveModel validations
[32m    is expected to validate that :token is case-sensitively unique[0m
[32m    is expected to validate that :invitee_email is case-insensitively unique within the scope of :invitable_id as long as it is not blank[0m
[32m    is expected to validate that :locale cannot be empty/falsy[0m
[32m    is expected to validate that :status cannot be empty/falsy[0m
[32m    is expected to validate that :locale is either â€¹"en"â€º, â€¹"fr"â€º, â€¹"es"â€º, or â€¹"uk"â€º[0m
    status transitions
[32m      prevents invalid transitions[0m
[32m      allows valid transitions[0m
  ActiveRecord associations
[32m    is expected to belong to invitee class_name => BetterTogether::Person optional: true[0m
[32m    is expected to belong to platform_role class_name => BetterTogether::Role required:[0m
[32m    is expected to belong to invitable class_name => BetterTogether::Platform required:[0m
[32m    is expected to belong to inviter class_name => BetterTogether::Person required:[0m
[32m    is expected to belong to community_role class_name => BetterTogether::Role required:[0m
  Attributes
[32m    is expected to respond to #locale[0m
[32m    is expected to respond to #status[0m
[32m    is expected to respond to #valid_from[0m
[32m    is expected to respond to #invitee_email[0m
[32m    is expected to respond to #valid_until[0m
[32m    is expected to respond to #accepted_at[0m
[32m    is expected to respond to #token[0m
[32m    is expected to respond to #last_sent[0m
  Scopes
    .expired
[32m      returns only expired invitations[0m
    .not_expired
[32m      returns invitations that are not expired or have no expiration[0m
    .pending
[32m      returns only pending invitations[0m
    .accepted
[32m      returns only accepted invitations[0m
  Methods
    #expired?
      when valid_until is nil
[32m        returns false[0m
      when valid_until is in the future
[32m        returns false[0m
      when valid_until is in the past
[32m        returns true[0m
  Throttle and Recent Email Checks
    #throttled?
      when more than 10 invitations have been created in the last 15 minutes by the same inviter
[32m        returns true[0m
      when 10 or fewer invitations have been created in the last 15 minutes by the same inviter
[32m        returns false[0m
    #email_recently_sent?
      when last_sent is within the last 15 minutes
[32m        returns true[0m
      when last_sent is older than 15 minutes
[32m        returns false[0m

with existing user
  when an invitation to person was declined with force_resend flag
[32m    allows creating a new invitation and removes the old one[0m
  when an invitation is pending
[32m    prevents creating a new invitation[0m

BetterTogether::Positioned
[32m  uses the exact scope value when provided (non-blank)[0m
[32m  treats blank scope values as nil when computing max position[0m

BetterTogether::ResourcePermission
[32m  exists[0m

BetterTogether::Content::BlocksHelper
  #acceptable_image_file_types
[32m    returns valid image content types[0m
  #sanitize_block_css
    with edge cases
[32m      returns empty string for blank input[0m
[32m      handles very long CSS strings[0m
[32m      returns empty string for nil input[0m
    with dangerous CSS patterns
[32m      removes expression() calls[0m
[32m      removes expression() with different casing[0m
[32m      removes javascript: URLs in url()[0m
[32m      removes multiple dangerous patterns[0m
[32m      preserves safe url() calls[0m
    with safe CSS
[32m      preserves child selectors[0m
[32m      preserves CSS custom properties[0m
[32m      preserves important declarations[0m
[32m      preserves pseudo-selectors with quotes[0m
[32m      preserves media queries[0m
[32m      preserves attribute selectors with quotes[0m
[32m      returns the CSS unchanged[0m
[32m      preserves multiple selectors with various characters[0m
  #temp_id_for
[32m    returns model id for persisted models[0m
[32m    generates a UUID for new models by default[0m
[32m    returns temp_id for new models[0m
  #sanitize_block_html
[32m    removes script tags[0m
[32m    allows safe HTML tags[0m
[32m    allows whitelisted attributes[0m

BetterTogether::WizardStep
  Factory
[32m    has a valid factory[0m
  Methods
    #mark_as_completed
[32m      marks the wizard step as completed and saves it[0m
  ActiveModel validations
[32m    is expected to validate that :completed is either â€¹trueâ€º or â€¹falseâ€º[0m
  ActiveRecord associations
[32m    is expected to belong to creator class_name => BetterTogether::Person optional: true[0m
[32m    is expected to belong to wizard_step_definition required:[0m

Event Invitation Token Processing
  valid_event_invitation_token_present? helper
    with valid invitation token in session
[32m      returns true for valid tokens[0m
    with expired invitation token in session
[32m      returns false and cleans up session for expired tokens[0m
    with invalid invitation token in session
[32m      returns false for non-existent tokens[0m
  ApplicationController set_event_invitation method
[32m    stores invitation token in session with expiration[0m
[32m    sets invitation locale correctly[0m
[32m    supports both token and invitation_token parameters[0m
  invitation URL generation and access
[32m    allows access via generated invitation URLs[0m
[32m    generates correct invitation URLs[0m
[32m    sets correct locale when accessing via invitation URL[0m
  EventsController invitation token processing
[32m    handles missing invitation tokens gracefully[0m
[32m    sets locale from invitation when token is processed[0m
[32m    processes expired invitations correctly[0m
[32m    processes invitation_token parameter[0m
[32m    handles invalid invitation tokens gracefully[0m
  multiple invitation tokens
[32m    handles switching between different invitation tokens[0m
[32m    maintains the most recent invitation token in session[0m
  invitation token parameter precedence
[32m    prioritizes invitation_token over token parameter[0m

BetterTogether::NotificationCacheWarmingJob
  job configuration
[32m    is queued on low_priority queue[0m
  cache key methods
    #notification_type_fragment_cache_key
[32m      builds type-specific cache key[0m
    #notification_fragment_cache_key
[32m      builds complete cache key[0m
  #should_warm_cache?
[32m    returns false for notification without record[0m
[32m    returns false for notification without cache key support[0m
[32m    returns false for old notifications[0m
[32m    returns true for recent notification with record and cache support[0m
  job enqueuing
[32m    can be enqueued with notification ids[0m
  #perform
[32m    warms cache for eligible notifications[0m
[32m    handles missing notifications gracefully[0m
[32m    skips ineligible notifications[0m
[32m    processes notifications with given ids[0m
  #warm_notification_fragments
[32m    renders notification partial to warm cache[0m
[32m    skips warming if cache already exists[0m
[32m    handles rendering errors gracefully[0m

BetterTogether::PlatformsHelper
[32m  exists[0m

message notifications
[32m  does not be marked as read if conversation is not loaded[0m
[32m  marked as read when conversation is loaded[0m

BetterTogether::Metrics::Share
[32m  exists[0m

BetterTogether::HubHelper
[32m  exists[0m

Pages filtering and sorting
  GET /pages
[32m    filters by title[0m
[32m    displays all pages without filters[0m

BetterTogether::Platform
  validations
    with valid https url
[32m      is expected to be valid[0m
    with invalid scheme
[32m      is invalid[0m
    with valid http url
[32m      is expected to be valid[0m

BetterTogether::NotificationsChannel
[32m  streams for the current person on subscribe[0m
[32m  does not raise on unsubscribe[0m

BetterTogether::CommunityInvitationPolicy
  #resend?
    with declined community invitation
[32m      allows resending[0m
    when user does not have permission on community
[32m      does not allow resending[0m
    with pending community invitation
[32m      allows resending[0m
    with accepted community invitation
[32m      does not allow resending[0m
  #create?
    when user has community management permission
[32m      allows creating[0m
    when user does not have permission on community
[32m      does not allow creating[0m
  #destroy?
    with pending community invitation
[32m      allows destroying[0m
    with accepted community invitation
[32m      does not allow destroying[0m

BetterTogether::RolesController
  PATCH /:locale/.../host/roles/:id
[32m    updates and redirects[0m
  GET /:locale/.../host/roles
[32m    renders index[0m
[32m    renders show for a role[0m

BetterTogether::Metrics::PageViewsController
[32m  returns 422 for invalid viewable[0m
[32m  creates a page view with valid params[0m

BetterTogether::Geography::StatesHelper
[32m  exists[0m

BetterTogether::HostDashboardHelper
[32m  exists[0m

BetterTogether::Joatu::AgreementStatusNotifier
[32m  includes unread notification count in message[0m

BetterTogether::Message
[32m  exists[0m

BetterTogether::EventInvitation
  enhanced scopes
    .for_email_addresses
[32m      returns only invitations with an email address but no invitee[0m
    .for_existing_users
[32m      returns only invitations with an invitee person[0m
  enhanced URL generation
[32m    generates URLs that link directly to the event with invitation token[0m
[32m    includes proper locale in generated URLs[0m
  invitation type helpers
    unknown invitation type
[32m      identifies as unknown when both are nil[0m
    email invitation
[32m      correctly identifies as email invitation[0m
    person invitation
[32m      correctly identifies as person invitation[0m
  locale handling
[32m    requires locale to be present[0m
[32m    validates locale is in available locales[0m
[32m    accepts valid locales[0m
  enhanced acceptance flow
    #decline!
[32m      sets status to declined[0m
    #after_accept!
[32m      handles missing community gracefully[0m
[32m      handles missing event creator gracefully[0m
[32m      creates event attendance with going status[0m
[32m      does not create duplicate community memberships[0m
    #accept!
[32m      sets status to accepted and calls after_accept![0m
  enhanced validations
    invitation uniqueness
[32m      prevents duplicate email invitations for the same event[0m
[32m      allows same person to be invited to different events[0m
[32m      allows duplicate invitations if previous one was declined[0m
[32m      prevents duplicate person invitations for the same event[0m
    invitee presence validation
[32m      requires either invitee or invitee_email[0m
[32m      accepts invitation with invitee_email only[0m
[32m      accepts invitation with invitee only[0m
  token generation
[32m    automatically generates a token before validation[0m
[32m    does not overwrite existing tokens[0m

BetterTogether::PersonBlockPolicy
  #index?
[32m    allows signed-in users[0m
  #destroy?
[32m    permits when agent is blocker[0m
[32m    denies when agent is not blocker[0m
  #create?
[32m    denies when reporter is not the blocker[0m
[32m    permits when agent is blocker and blocked is not a platform manager[0m
[32m    denies when blocked is a platform manager[0m

BetterTogether::ChecklistPolicy
  #update?
    normal user
[32m      is expected to equal false[0m
    creator
[32m      is expected to equal true[0m
    manager
[32m      is expected to equal true[0m
  #create?
    manager
[32m      is expected to equal true[0m
    normal user
[32m      is expected to equal false[0m
  #destroy?
    creator
[32m      is expected to equal false[0m
    manager
[32m      is expected to equal true[0m

BetterTogether::Metrics::SharesController
[32m  tracks a share with valid params[0m
[32m  returns 422 for invalid platform/url[0m

BetterTogether::Joatu::Request
[32m  is valid with only a target_type[0m
[32m  is valid without a target[0m
[32m  is valid with a target[0m
[32m  is invalid without a creator[0m
[32m  is invalid without categories[0m
[32m  is invalid without target_type when target_id is set[0m

BetterTogether::EventInvitation
  enhanced validations
    invitation uniqueness
[32m      prevents duplicate person invitations for the same event[0m
[32m      allows duplicate invitations if previous one was declined[0m
[32m      prevents duplicate email invitations for the same event[0m
[32m      allows same person to be invited to different events[0m
    invitee presence validation
[32m      accepts invitation with invitee only[0m
[32m      requires either invitee or invitee_email[0m
[32m      accepts invitation with invitee_email only[0m

BetterTogether::PageAuthorshipNotifier
[32m  includes actor name in title when provided[0m
[32m  includes unread notification count in message[0m

Declined Invitation Resend
  when resending to declined user
[32m    includes force_resend parameter in the request[0m
  when viewing declined invitations
[32m    does not resend when confirmation is cancelled[0m
[32m    shows confirmation dialog when clicking resend for declined invitation[0m
[32m    displays special resend button with warning style[0m

BetterTogether::NotificationsController
  GET #dropdown
[32m    returns HTML content[0m
[32m    caches the response based on max updated_at[0m
[32m    updates cache when notification changes[0m
[32m    returns successful response[0m
    with no notifications
[32m      returns empty state content[0m
  PATCH #mark_as_read
    with no parameters
[32m      marks all notifications as read[0m
    with record_id parameter
[32m      marks notifications for that record as read[0m
    with specific notification id
[32m      marks the notification as read[0m
[32m      redirects to notifications path for HTML requests[0m
[32m      returns turbo stream for turbo requests[0m
  cache warming
[32m    works in production environment[0m
[32m    does not call warm_notification_fragment_caches outside production[0m
  GET #index
[32m    returns successful response[0m
[32m    assigns notifications and unread count[0m
[32m    orders notifications by created_at desc[0m

Invitation Error Handling
  handling validation errors
[32m    handles turbo stream error responses[0m
[32m    returns error message for missing email[0m

BetterTogether::Metrics::LinkClicksHelper
[32m  exists[0m

ChecklistItems Reorder
[32m  reorders items[0m

BetterTogether::PersonCommunityMembershipsHelper
[32m  exists[0m

calls_for_interest/index.html.erb
[32m  works[0m

BetterTogether::Person
  ActiveModel validations
[32m    is expected to validate that :name cannot be empty/falsy[0m
  Methods
[32m    is expected to respond to #to_s[0m
  #to_s
[32m    returns the name as a string representation[0m
  Factory
[32m    has a valid factory[0m
  Attributes
[32m    is expected to respond to #identifier[0m
[32m    is expected to respond to #description[0m
[32m    is expected to respond to #name[0m
  behaves like an identity
[32m    has identity in its ancestor tree[0m
    ActiveRecord associations
[32m      is expected to have many identifications[0m
  behaves like a friendly slugged record
    extends ::FriendlyId
[32m      is expected to respond to #slugged[0m
[32m      is expected to respond to #friendly_id[0m
  behaves like has_id
[32m    has BetterTogetherID in its ancestor tree[0m
    callbacks
[32m      is expected to callback generate_id before validation[0m

BetterTogether::Geography::StatesController
  GET /:locale/.../host/geography/states/:id
[32m    renders show[0m
  GET /:locale/.../host/geography/states
[32m    renders index[0m

BetterTogether::Metrics::HttpLinkChecker
[32m  returns success for 200 head response[0m
[32m  retries and returns failure for unreachable host[0m

Enhanced Event Invitation System
  dual-path invitation system
    person-based invitations
[32m      creates invitations with automatic email and locale[0m
[32m      prevents duplicate invitations[0m
[32m      enqueues notifications on correct queue[0m
    email-based invitations
[32m      prevents duplicate email invitations[0m
[32m      creates invitations with specified locale[0m
[32m      allows invitations to different emails[0m
  private event access
[32m    denies access without invitation token[0m
[32m    allows RSVP with valid invitation token[0m
[32m    denies access with invalid token[0m
[32m    denies access with expired token[0m
[32m    allows ICS download with valid invitation token[0m
    allows access with valid invitation token
[32m      allows access to private event[0m
  invitation token validation
[32m    handles declined tokens gracefully[0m
[32m    handles expired tokens properly[0m
[32m    handles non-existent tokens gracefully[0m
[32m    allows access to public events without tokens[0m
[32m    accepts valid tokens[0m
  invitation status display
[32m    shows accepted invitations[0m
[32m    shows rejected invitations[0m
[32m    shows pending invitations[0m
  platform privacy bypass
[32m    allows event access via invitation on private platform[0m
[32m    redirects to sign in without invitation token[0m

creating a new conversation
[32m  between a platform manager and normal user[0m
  as a normal user
[32m    cannot create conversations with private users[0m
[32m    can create a conversation with a public person who opted into messages[0m

Event location selector
[33m  creates event with new address when saving (PENDING: temporarily disabled (location selector flakiness))[0m
[33m  shows inline new address and building blocks (PENDING: temporarily disabled (location selector flakiness))[0m
[33m  creates event with new building when saving (PENDING: temporarily disabled (location selector flakiness))[0m

BetterTogether::Metrics::RichTextLinkIdentifier
[32m  creates link and rich_text_link records[0m

BetterTogether::Geography::CountriesHelper
[32m  exists[0m

BetterTogether::Geography::Country
[32m  exists[0m

BetterTogether::Geography::Map
[32m  exists[0m

BetterTogether::ConversationMailer
  new_message_notification
[32m    sends a message notification email[0m
[32m    sends the message notification to the correct email address[0m
[32m    renders the headers[0m
[32m    renders the body[0m

Requests aggregated matches
[32m  shows Potential Matches for my requests with matching offers[0m

Setup Wizard Flow
[33m  redirects from root and completes the first wizard step using platform attributes (PENDING: flaky/setup_wizard - disabled while debugging suite)[0m

BetterTogether::EventInvitation
  scopes
    .for_existing_users
[32m      returns only person invitations[0m
    .for_email_addresses
[32m      returns only email invitations[0m
  #after_accept!
    with person invitation
[32m      creates event attendance[0m
  invitation types
    with person invitation
[32m      identifies as person invitation[0m
    with email invitation
[32m      identifies as email invitation[0m
  validations
    when inviting an existing person
[32m      is expected to be valid[0m
[32m      prevents duplicate person invitations[0m
    when inviting by email
[32m      is expected to be valid[0m
[32m      prevents duplicate email invitations[0m
    when both invitee and invitee_email are blank
[32m      has the correct error message[0m
[32m      is expected not to be valid[0m

BetterTogether::Identification
  has a valid factory
[32m    is expected to be valid[0m
  behaves like has_id
[32m    has BetterTogetherID in its ancestor tree[0m
    callbacks
[32m      is expected to callback generate_id before validation[0m
  ActiveRecord associations
[32m    is expected to belong to agent required:[0m
[32m    is expected to belong to identity required:[0m
  #active
[32m    is expected to respond to #active[0m
  ActiveModel validations
[32m    is expected to validate that :identity cannot be empty/falsy[0m
[32m    is expected to validate that :agent cannot be empty/falsy[0m

Duplicate Invitation Prevention
  preventing duplicate invitations
    when an invitation was accepted
[32m      prevents creating a new invitation[0m
    when an invitation was declined with force_resend flag
[32m      allows creating a new invitation and removes the old one[0m
    when an invitation was declined without force_resend flag
[32m      prevents creating a new invitation[0m
    when an invitation is pending
[32m      prevents creating a new invitation[0m

BetterTogether::Geography::LocatableLocation
  class methods
    .available_buildings_for
      when context is a Person with user
[32m        uses policy scope to return authorized buildings[0m
[32m        includes proper associations[0m
      when context is a Community
[32m        returns only public buildings[0m
      when context is nil
[32m        returns empty scope[0m
      when context is a Person without user
[32m        returns only public buildings[0m
      when context is unsupported type
[32m        returns empty scope[0m
    .permitted_attributes
[32m      includes location-specific attributes[0m
    .available_addresses_for
      when context is unsupported type
[32m        returns only public addresses[0m
      when context is a Community
[32m        returns community addresses and public addresses[0m
      when context is a Person without user
[32m        returns only public addresses[0m
      when context is nil
[32m        returns empty scope[0m
      when context is a Person with user
[32m        includes proper associations[0m
[32m        uses policy scope to return authorized addresses[0m
  validations
    when neither name nor location provided
[32m      is expected not to be valid[0m
[32m      adds validation error[0m
    when simple location
[32m      is expected to be valid[0m
[32m      is expected to validate that :name cannot be empty/falsy[0m
    when structured location
[32m      is expected to be valid[0m
[32m      does not require name for structured locations[0m
  associations
[32m    is expected to belong to locatable required:[0m
[32m    is expected to belong to location optional: true[0m
  instance methods
    #building?
[32m      returns false for non-building locations[0m
[32m      returns true for building locations[0m
    #structured_location?
[32m      returns opposite of simple_location?[0m
    #building
      when location_type is Building
[32m        returns the location[0m
      when location_type is not Building
[32m        returns nil[0m
    #address
      when location_type is not Address
[32m        returns nil[0m
      when location_type is Address
[32m        returns the location[0m
    #geocoding_string
      when location does not respond to geocoding_string
[32m        returns name as fallback[0m
      when location responds to geocoding_string
[32m        delegates to location[0m
    #address?
[32m      returns true for address locations[0m
[32m      returns false for non-address locations[0m
    #simple_location?
      when location is present
[32m        returns false[0m
      when location is blank
[32m        returns true[0m
    #to_s
[32m      returns display_name[0m
    #display_name
      when neither name nor location are present
[32m        returns default text[0m
      when name is present
[32m        returns the name[0m
      when location is present but name is not
[32m        returns location.to_s[0m

BetterTogether::Infrastructure::Building
  Attributes
[32m    is expected to respond to #rooms_count[0m
[32m    is expected to respond to #floors_count[0m
[32m    is expected to respond to #name[0m
[32m    is expected to respond to #slug[0m
[32m    is expected to respond to #description[0m
  ActiveRecord associations
[32m    is expected to have many floors class_name => BetterTogether::Infrastructure::Floor dependent => destroy[0m
[32m    is expected to have many rooms class_name => BetterTogether::Infrastructure::Room through floors dependent => destroy[0m
  Factory
[32m    has a valid factory[0m
[32m    builds a building with rooms[0m
[32m    creates a building with floors[0m
  ActiveModel validations
[32m    is expected to validate that :name cannot be empty/falsy[0m
  Methods
    #to_s
[32m      returns the name as a string representation[0m
    #ensure_floor
[32m      creates a floor if none exist[0m

BetterTogether::Geography::MapsHelper
[32m  exists[0m

BetterTogether::Users::RegistrationsController
  captcha hook methods
    #validate_captcha_if_enabled?
[32m      returns true by default (no captcha validation)[0m
    #handle_captcha_validation_failure
[32m      adds error to resource and calls respond_with[0m

Joatu invalid inputs
[32m  fails to create a request without a name[0m

BetterTogether::CommunityInvitationPolicy
  #resend?
    when user does not have permission
[32m      does not allow resending[0m
    when user is not present
[32m      does not allow resending[0m
    when user is present and has permission
      with accepted invitation
[32m        does not allow resending[0m
      with pending invitation
[32m        allows resending[0m
      with declined invitation
[32m        allows resending[0m
  #create?
    when user is not present
[32m      does not allow creating[0m
    when user does not have permission
[32m      does not allow creating[0m
    when user is present and has permission on invitable
[32m      allows creating[0m
  #destroy?
    when user is not present
[32m      does not allow destroying[0m
    when user is present and has permission
      with pending invitation
[32m        allows destroying[0m
      with accepted invitation
[32m        does not allow destroying[0m
    when user does not have permission
[32m      does not allow destroying[0m

BetterTogether::Metrics::LinkClick
[32m  exists[0m

BetterTogether::EventAttendance
[32m  includes expected error for invalid status[0m
[32m  enforces uniqueness per event/person[0m
[32m  validates inclusion of status[0m
[32m  includes uniqueness error for duplicate attendance[0m

BetterTogether::ConversationPolicy
  #create? with participants kwarg
[32m    allows create when user present and participants are permitted[0m
[32m    defaults to basic presence check when participants nil[0m
[32m    denies create when any participant is not permitted[0m
  #permitted_participants
    when agent is a platform manager
[32m      includes all people[0m
    when agent is a regular member
[32m      includes platform managers and opted-in members, but not non-opted members[0m

BetterTogether::Metrics::Download
[32m  exists[0m

BetterTogether::GeographyBuilder
  .clear_existing
[32m    removes all geography records[0m
  .seed_continents
[32m    creates continents from the predefined list[0m

BetterTogether::Metrics::LinkClickReport
[32m  exists[0m

BetterTogether::Metrics::RichTextLinkCheckerQueueJob
[32m  schedules child jobs spread across time window per host[0m

BetterTogether::Geography::RegionSettlementsController
  GET /:locale/.../host/geography/region_settlements
[32m    renders index[0m
  GET /:locale/.../host/geography/region_settlements/:id
[32m    renders show[0m

BetterTogether::Geography::CountriesController
  GET /:locale/.../host/geography/countries/:id
[32m    renders show[0m
  GET /:locale/.../host/geography/countries
[32m    renders index[0m

Joatu agreement rejection
[32m  rejects an agreement without closing offer or request[0m

Translatable Attachments integration
[32m  attaches a real blob and the getter returns the attachment[0m
[32m  returns a rails_blob_url for attached blob[0m

User Registration
  POST /en/users
    when creating a user with person attributes
[32m      handles person validation errors gracefully[0m
[32m      creates user, person, and community membership successfully[0m
    when agreements are not accepted
[32m      does not create user or person[0m

BetterTogether::EventHost
[33m  add some examples to (or delete) /community-engine/spec/models/better_together/event_host_spec.rb (PENDING: Not yet implemented)[0m

BetterTogether::PersonBlocksController
  DELETE #destroy
[32m    destroys the PersonBlock[0m
[32m    sets success flash message[0m
[32m    redirects to blocks path[0m
    when trying to destroy someone elses block
[32m      renders not found (404)[0m
    with AJAX request
[32m      responds with turbo_stream[0m
    when not authenticated
[32m      redirects to sign in[0m
  GET #new
[32m    returns http success[0m
[32m    assigns a new person_block[0m
    when not authenticated
[32m      redirects to sign in[0m
  GET #search
[32m    returns searchable people as JSON[0m
[32m    requires authentication[0m
[32m    excludes already blocked people from search results[0m
[32m    excludes current user from search results[0m
  GET #index
    when user has blocked people
[32m      filters blocked users by search query[0m
[32m      returns empty results for non-matching search[0m
[32m      shows blocked users in the list[0m
[32m      provides blocked users count[0m
[32m      includes blocking timestamp information[0m
[32m      assigns @blocked_people[0m
[32m      returns http success[0m
    when user has no blocked people
[32m      shows zero count[0m
[32m      returns empty blocked_people[0m
    when not authenticated
[32m      redirects to sign in[0m
  POST #create
    when not authenticated
[32m      redirects to sign in[0m
    when blocking by person ID
[32m      creates a new PersonBlock by person ID[0m
    with invalid params
      when trying to block platform administrator
[32m        sets error flash message[0m
[32m        does not create a PersonBlock[0m
      when trying to block self
[32m        sets error flash message[0m
[32m        does not create a PersonBlock[0m
    with valid params
[32m      creates a new PersonBlock[0m
[32m      redirects to blocks path[0m
[32m      sets success flash message[0m
      with AJAX request
[32m        responds with turbo_stream[0m

shared/resource_toolbar
[32m  renders additional content from block in extra section[0m
[32m  omits buttons when paths are missing[0m
[32m  renders provided action buttons[0m

Respond with Offer from Request
[32m  shows respond with offer button and redirects with source params[0m

BetterTogether::MessagesHelper
[32m  exists[0m

Successful Invitation Creation
[32m  creates a valid invitation successfully[0m

BetterTogether::ImageHelper
  #profile_image_tag
    when person has profile_image_url method
[32m      uses the optimized profile_image_url method[0m
[33m      respects custom size parameter (PENDING: Temporarily skipped with xit)[0m
    when person has no profile image
[32m      returns a default image tag[0m

BetterTogether::Joatu::SearchFilter
  for offers
    behaves like search filter
[32m      respects the base relation (policy scope)[0m
[32m      searches by ActionText description[0m
[32m      searches by Mobility name[0m
[32m      filters by category ids via types_filter[][0m
[32m      orders by oldest when requested[0m
[32m      applies per_page when pagination is available[0m
[32m      filters by status=open[0m
[32m      searches by category name (Mobility, with fallback)[0m
  for requests
    behaves like search filter
[32m      orders by oldest when requested[0m
[32m      searches by Mobility name[0m
[32m      filters by category ids via types_filter[][0m
[32m      searches by category name (Mobility, with fallback)[0m
[32m      searches by ActionText description[0m
[32m      respects the base relation (policy scope)[0m
[32m      applies per_page when pagination is available[0m
[32m      filters by status=open[0m

BetterTogether::Metrics::TrackPageViewJob
  UTF-8 URL handling
[32m    creates PageView records without errors[0m
    handles pageables with UTF-8 URLs
[32m      creates page view when page URL contains UTF-8 characters[0m

MyJob
[32m  queues the job[0m

Basic Invitation Creation
  creating invitations
[32m    successfully creates an invitation for a new email[0m

BetterTogether::Joatu::AgreementPolicy
  as request creator
[32m    permits participant actions[0m
  as unrelated user
[32m    forbids participant actions[0m
  as offer creator
[32m    permits participant actions[0m

BetterTogether::ChecklistItemPolicy
  #create?
    normal user
[32m      is expected to equal false[0m
    manager
[32m      is expected to equal true[0m
  #destroy?
    manager
[32m      is expected to equal true[0m
    creator
[32m      is expected to equal false[0m
  #update?
    normal user
[32m      is expected to equal false[0m
    creator
[32m      is expected to equal true[0m
    manager
[32m      is expected to equal true[0m

BetterTogether::Community
  callbacks
    #single_host_record
[32m      adds an error if host is set and another host community exists[0m
  Factory
[32m    has a valid factory[0m
  behaves like a friendly slugged record
    extends ::FriendlyId
[32m      is expected to respond to #slugged[0m
[32m      is expected to respond to #friendly_id[0m
  #to_s
[32m    returns the name as a string representation[0m
  Attributes
[32m    is expected to respond to #host[0m
[32m    is expected to respond to #slug[0m
[32m    is expected to respond to #creator_id[0m
[32m    is expected to respond to #privacy[0m
[32m    is expected to respond to #name[0m
[32m    is expected to respond to #description[0m
  ActiveRecord associations
[32m    is expected to belong to creator class_name => ::BetterTogether::Person optional: true[0m
  Methods
[32m    is expected to respond to #set_as_host[0m
[32m    is expected to respond to #to_s[0m
    #set_as_host
      when there is no host community
[32m        sets the host attribute to true[0m
      when a host community already exists
[32m        does not set the host attribute to true[0m
  behaves like has_id
[32m    has BetterTogetherID in its ancestor tree[0m
    callbacks
[32m      is expected to callback generate_id before validation[0m

BetterTogether::NavigationAreasController
  with platform manager role
    DELETE /:locale/.../navigation_areas/:id
[32m      destroys and redirects[0m
    GET /:locale/.../navigation_areas
[32m      renders new[0m
[32m      renders index[0m
    PATCH /:locale/.../navigation_areas/:id
[32m      renders edit on invalid params (HTML 200)[0m
[32m      updates and redirects on valid params, applying changes[0m
    POST /:locale/.../navigation_areas
[32m      creates and redirects on valid params, persisting permitted fields[0m
[32m      renders new on invalid params (HTML 200)[0m

User registration agreements
[32m  requires accepting agreements during sign up[0m
[32m  creates agreement participants when agreements are accepted[0m

Pending: (Failures listed here are expected and do not affect your suite's status)
[33m
  1) BetterTogether::Metrics::RichTextLink add some examples to (or delete) /community-engine/spec/models/better_together/metrics/rich_text_link_spec.rb[0m
     [36m# Not yet implemented[0m
[36m     # ./spec/models/better_together/metrics/rich_text_link_spec.rb:7
[0m[33m
  2) Person completes checklist allows a person to complete all items and shows completion message[0m
     [36m# Temporarily skipped with xit[0m
[36m     # ./spec/features/checklist_person_completion_spec.rb:18
[0m
  3) BetterTogether::Generators::InvitationGenerator migration generation migration generation is pending Rails 8 migration_template API fix
     [36m# Rails 8 migration_template API requires updates[0m
     [33mFailure/Error: [0massert_migration [31m[1;31m'[0m[31mcreate_better_together_project_invitations[1;31m'[0m[31m[0m[0m
     [33m[0m
     [33mMinitest::Assertion:[0m
     [33m  Expected migration create_better_together_project_invitations to exist, but was not found[0m
     [36m# /usr/local/bundle/gems/minitest-5.26.2/lib/minitest/assertions.rb:176:in 'Minitest::Assertions#assert'[0m
     [36m# /usr/local/bundle/gems/railties-8.0.3/lib/rails/generators/testing/assertions.rb:66:in 'Rails::Generators::Testing::Assertions#assert_migration'[0m
     [36m# /usr/local/bundle/gems/generator_spec-0.10.0/lib/generator_spec/test_case.rb:37:in 'GeneratorSpec::TestCase#method_missing'[0m
     [36m# ./spec/lib/better_together/generators/invitation_generator_spec.rb:125:in 'block (3 levels) in <top (required)>'[0m
     [36m# /usr/local/bundle/gems/webmock-3.26.1/lib/webmock/rspec.rb:39:in 'block (2 levels) in <top (required)>'[0m
     [36m# /usr/local/bundle/gems/rspec-rebound-0.2.1/lib/rspec/rebound.rb:129:in 'block in RSpec::Rebound#run'[0m
     [36m# /usr/local/bundle/gems/rspec-rebound-0.2.1/lib/rspec/rebound.rb:115:in 'RSpec::Rebound#run'[0m
     [36m# /usr/local/bundle/gems/rspec-rebound-0.2.1/lib/rspec_ext/rspec_ext.rb:12:in 'RSpec::Core::Example::Procsy#run_with_retry'[0m
     [36m# /usr/local/bundle/gems/rspec-rebound-0.2.1/lib/rspec/rebound.rb:43:in 'block (2 levels) in RSpec::Rebound.setup'[0m
[33m
  4) Event location selector creates event with new address when saving[0m
     [36m# temporarily disabled (location selector flakiness)[0m
[36m     # ./spec/features/events/location_selector_spec.rb:44
[0m[33m
  5) Event location selector shows inline new address and building blocks[0m
     [36m# temporarily disabled (location selector flakiness)[0m
[36m     # ./spec/features/events/location_selector_spec.rb:6
[0m[33m
  6) Event location selector creates event with new building when saving[0m
     [36m# temporarily disabled (location selector flakiness)[0m
[36m     # ./spec/features/events/location_selector_spec.rb:86
[0m[33m
  7) Setup Wizard Flow redirects from root and completes the first wizard step using platform attributes[0m
     [36m# flaky/setup_wizard - disabled while debugging suite[0m
[36m     # ./spec/features/setup_wizard_spec.rb:6
[0m[33m
  8) BetterTogether::EventHost add some examples to (or delete) /community-engine/spec/models/better_together/event_host_spec.rb[0m
     [36m# Not yet implemented[0m
[36m     # ./spec/models/better_together/event_host_spec.rb:7
[0m[33m
  9) BetterTogether::ImageHelper#profile_image_tag when person has profile_image_url method respects custom size parameter[0m
     [36m# Temporarily skipped with xit[0m
[36m     # ./spec/helpers/better_together/image_helper_spec.rb:35
[0m

Finished in 7 minutes 25 seconds (files took 6.14 seconds to load)
[33m1416 examples, 0 failures, 9 pending[0m

Randomized with seed 40244

