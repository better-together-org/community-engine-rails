<% content_for :page_title do %>
  <%= @joatu_request %> | <%= resource_class.model_name.human.pluralize %>
<% end %>

<%= render 'better_together/joatu/shared/exchange_nav' %>

<div class="container my-3">
  <%= render 'better_together/shared/help_banner',
             id: 'joatu-requests-show',
             i18n_key: 'better_together.joatu.help.requests.show' %>
  <h1 class="mb-4"><%= @joatu_request.name %></h1>

  <div class="mb-3">
    <%= @joatu_request.description %>
  </div>

  <div class="mt-3">
    <% if policy(resource_class).index? %>
      <%= link_to t('better_together.joatu.requests.back_to_requests', default: 'Back to Requests'), joatu_requests_path, class: 'btn btn-sm btn-outline-secondary' %>
    <% end %>
    <% if policy(@joatu_request).edit? %>
      <%= link_to edit_joatu_request_path(@joatu_request), class: 'btn btn-outline-primary btn-sm me-2', 'aria-label' => 'Edit Request' do %>
        <i class="fas fa-edit"></i> <%= t('globals.edit') %>
      <% end %>
    <% end %>
    <% if policy(@joatu_request).destroy? %>
      <%= link_to joatu_request_path(@joatu_request), data: { turbo_method: :delete, turbo_confirm: t('globals.confirm_delete') }, class: 'btn btn-outline-danger btn-sm', 'aria-label' => 'Delete Record' do %>
        <i class="fas fa-trash-alt"></i> <%= t('globals.delete') %>
      <% end %>
    <% end %>
  </div>
</div>

<%# If this request was created in response to an Offer, show that Offer and skip potential matches %>
<% source_link = @joatu_request.response_links_as_response.find_by(source_type: 'BetterTogether::Joatu::Offer') %>
<% if source_link %>
  <% source_offer = source_link.source %>
  <div class="container my-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title"><%= t('better_together.joatu.requests.source_offer_heading', default: 'Responding to Offer') %></h5>
        <h3><%= link_to source_offer.name, joatu_offer_path(source_offer), class: 'text-decoration-none' %></h3>
        <p class="text-muted"><%= t('better_together.joatu.by', default: 'by') %> <%= source_offer.creator&.name || source_offer.creator&.to_s %> | <%= l(source_offer.created_at, format: :long) if source_offer.created_at %></p>
        <div class="mt-2"><%= simple_format(source_offer.description.to_plain_text) %></div>
      </div>
    </div>
  </div>
<% else %>
  <%# Render potential matches for the creator when this request is not a direct response %>
  <% if defined?(current_person) && current_person == @joatu_request.creator %>
    <%= render 'better_together/joatu/shared/match_list', resource: @joatu_request %>
  <% end %>
<% end %>
