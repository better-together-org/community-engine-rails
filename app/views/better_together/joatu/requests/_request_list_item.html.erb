<% request_model ||= request_list_item %>
<a href="<%= joatu_request_path(request_model) %>" class="list-group-item">
  <h4 class="mb-1 d-flex justify-content-between align-items-start">
    <span class="me-2 flex-grow-1"><%= request_model.name %></span>

    <span class="ms-2 d-flex align-items-center" aria-hidden="true">
      <%# Badge: item created by current user (small, right-aligned) %>
      <% if defined?(current_person) && request_model.creator == current_person %>
        <span class="badge bg-primary ms-2" style="font-size: small;"><%= t('better_together.joatu.you', default: 'You') %></span>
      <% end %>

      <%# Badge: item created in response to a resource owned by current_person (small, right-aligned) %>
      <% if defined?(current_person) %>
        <% response_link = request_model.response_links_as_response.find { |rl| rl.source&.creator == current_person } rescue nil %>
        <% if response_link.present? %>
          <% source_type_key = response_link.source_type.demodulize.underscore rescue 'item' %>
          <span class="badge bg-info text-dark ms-2" style="font-size: small;"><%= t('better_together.joatu.response_to_your', type: t("better_together.joatu.type.#{source_type_key}", default: response_link.source_type.demodulize), default: "Response to your %{type}", type: t("better_together.joatu.type.#{source_type_key}", default: response_link.source_type.demodulize)) %></span>
        <% end %>
      <% end %>
    </span>
  </h4>
  <div class="text-muted small mb-1">
    <%= t('better_together.joatu.type.request', default: 'Request') %> |
    <%= t('better_together.joatu.by', default: 'by') %> <%= request_model.creator&.name || request_model.creator&.to_s %> |
    <%= l(request_model.created_at, format: :long) if request_model.created_at %>
  </div>
  <div class="mb-1">
    <span class="badge bg-secondary"><%= request_model.status %></span>
    <span class="badge bg-warning text-dark"><%= request_model.urgency %></span>
  </div>
  <p class="mb-0"><%= truncate(request_model.description.to_plain_text, length: 100) %></p>
  <div class="mt-1">
    <% request_model.categories.first(3).each do |cat| %>
      <span class="badge bg-light text-dark border"><%= cat.name %></span>
    <% end %>
  </div>
</a>
