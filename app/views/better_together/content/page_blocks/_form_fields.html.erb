
<% temp_id = page_block.persisted? ? page_block.id : SecureRandom.uuid %>

<div id="<%= dom_id(page_block, temp_id) %>" class="block-fields">

  <!-- Hidden field for PageBlock ID, only if the PageBlock is persisted -->
  <% if page_block.persisted? %>
    <%= hidden_field_tag "page[page_blocks_attributes][][id]", page_block.id %>
  <% end %>

  <!-- Position field -->
  <div class="mb-3">
    <%= label_tag "page[page_blocks_attributes][][position]", "Block Position" %>
    <%= number_field_tag "page[page_blocks_attributes][][position]", page_block.position, class: "form-control#{' is-invalid' if page_block.errors[:position].any?}" %>
    
    <% if page_block.errors[:position].any? %>
      <div class="invalid-feedback">
        <%= page_block.errors[:position].join(", ") %>
      </div>
    <% end %>
  </div>

  <!-- Nested Block fields -->
  <div class="block">
    <!-- Hidden field for Block ID -->
    <%= hidden_field_tag "page[page_blocks_attributes][][block_attributes][id]", page_block.block.id %>
    <%= hidden_field_tag "page[page_blocks_attributes][][block_attributes][type]", page_block.block.class.to_s %>

    <div class="mb-3">
      <%= label_tag "page[page_blocks_attributes][][block_attributes][content]", "Block Content" %>
      <%= rich_text_area_tag "page[page_blocks_attributes][][block_attributes][content]", page_block.block.content, class: "form-control#{' is-invalid' if page_block.block.errors[:content].any?}", data: { controller: 'trix' } %>
      
      <% if page_block.block.errors[:content].any? %>
        <div class="invalid-feedback">
          <%= page_block.block.errors[:content].join(", ") %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Hidden destroy field -->
  <%= hidden_field_tag "page[page_blocks_attributes][][_destroy]", false %>

  <!-- Button to remove the block dynamically -->
  <%= link_to "Remove Block", page_page_block_path(page_block.page, (page_block.id || temp_id)), class: "btn btn-danger mb-3", data: { turbo_method: :delete } %>

</div>
