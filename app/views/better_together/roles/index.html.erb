<% content_for :page_title do %>
  <%= resource_class.model_name.human.pluralize %>
<% end %>

<div class="container my-3">
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <h1 class="mb-0"><%= resource_class.model_name.human.pluralize %></h1>

    <div class="d-flex align-items-center gap-2">
      <%= render 'better_together/shared/view_switcher',
                 view_key: 'roles_index',
                 active_view: @view_type,
                 available_views: @available_view_types,
                 update_path: view_preferences_path(locale: I18n.locale) %>

      <% if policy(resource_class).create? %>
        <%= link_to new_role_path, class: 'btn btn-primary btn-sm' do %>
          <i class="fas fa-plus"></i> <%= t('.new_role') %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div data-controller="better_together--tabs">
    <ul class="nav nav-tabs mb-3" role="tablist">
    <% @roles_by_resource_type.each_with_index do |(resource_type, _roles), index| %>
      <% tab_id = "roles-#{resource_type.parameterize}" %>
      <li class="nav-item" role="presentation">
        <button class="nav-link <%= 'active' if index.zero? %>"
                id="<%= "#{tab_id}-tab" %>"
                data-bs-toggle="tab"
                data-bs-target="<%= "##{tab_id}" %>"
                data-better_together--tabs-target="tab"
                type="button"
                role="tab"
                aria-controls="<%= tab_id %>"
                aria-selected="<%= index.zero? %>">
          <%= role_resource_type_label(resource_type) %>
        </button>
      </li>
    <% end %>
    </ul>

    <div class="tab-content">
    <% @roles_by_resource_type.each_with_index do |(resource_type, roles), index| %>
      <% tab_id = "roles-#{resource_type.parameterize}" %>
      <div class="tab-pane fade <%= 'show active' if index.zero? %>"
           id="<%= tab_id %>"
           role="tabpanel"
           aria-labelledby="<%= "#{tab_id}-tab" %>">
        <% if @view_type == 'table' %>
          <div class="table-responsive role-table-group">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th><%= resource_class.human_attribute_name(:identifier) %></th>
                  <th><%= resource_class.human_attribute_name(:name) %></th>
                  <th><%= resource_class.human_attribute_name(:description) %></th>
                  <th><%= t('better_together.roles.permissions.label') %></th>
                  <th><%= resource_class.human_attribute_name(:position) %></th>
                  <th><%= resource_class.human_attribute_name(:protected) %></th>
                  <th class="text-end"><%= t('globals.actions') %></th>
                </tr>
              </thead>
              <tbody>
                <%= render partial: 'better_together/roles/role', collection: roles, as: :role %>
              </tbody>
            </table>
          </div>
        <% else %>
          <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3 role-card-group">
            <%= render partial: 'better_together/roles/role_card', collection: roles, as: :role %>
          </div>
        <% end %>
      </div>
    <% end %>
    </div>
  </div>
</div>
