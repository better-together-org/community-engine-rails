<% min_password_length = Devise.password_length.min %>

<%= form_for @form, url: setup_wizard_step_create_admin_path(wizard_id: 'host_setup', wizard_step_definition_id: :admin_creation), method: :post, class: 'needs-validation form', id: 'admin-creation-form', data: { turbo: false, controller: 'better_together--form-validation', action: 'submit->better_together--form-validation#validateBeforeSubmit' } do |f| %>

  <!-- Hero Section -->
  <div class="container-fluid p-0">
    <div class="hero-section" style="background: url(<%= asset_path('better_together/unsplash-community-1.jpeg') %>) no-repeat center center; background-size: cover; height: 50vh;">
      <div class="overlay" style="background: rgba(0, 0, 0, 0.3); height: 100%; width: 100%;">
        <div class="container h-100 d-flex align-items-center justify-content-center">
          <div class="text-center text-white">
            <h1 class="display-4 fw-bold"><%= t('.hero.title') %></h1>
            <p class="lead">
              <%= t('.hero.subtitle') %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Section -->
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <!-- Progress Indicator -->
        <div class="mb-4">
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
              <%= t('.progress.step') %>
            </div>
          </div>
        </div>

        <p class="text-center mb-4">
          <%= t('.intro') %>
        </p>

        <% if @form.errors.any? %>
          <div class="alert alert-danger">
            <h4><%= t('.errors.header_plural', count: @form.errors.count) %></h4>
            <ul>
              <% @form.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- Email Field -->
        <div class="mb-3">
          <%= f.label :email, t('.fields.email.label'), class: 'form-label' %>
          <%= f.email_field :email, autofocus: true, required: true,
                class: "form-control#{' is-invalid' if @form.errors[:email].any?}",
                data: { action: 'blur->better_together--form-validation#validate' } %>
          <small class="form-text text-muted"><%= t('.fields.email.help') %></small>
          <% if @form.errors[:email].any? %>
            <div class="invalid-feedback d-block"><%= @form.errors[:email].join(', ') %></div>
          <% end %>
        </div>

        <!-- Password Field -->
        <div class="mb-3">
          <%= f.label :password, t('.fields.password.label'), class: 'form-label' %>
          <%= f.password_field :password, required: true, minlength: min_password_length,
                class: "form-control#{' is-invalid' if @form.errors[:password].any?}",
                data: { action: 'blur->better_together--form-validation#validate', 'better_together--form-validation-min-length-value': min_password_length } %>
          <small class="form-text text-muted">
            <%= t('.fields.password.help', min_length: min_password_length) %>
          </small>
          <% if @form.errors[:password].any? %>
            <div class="invalid-feedback d-block"><%= @form.errors[:password].join(', ') %></div>
          <% end %>
        </div>

        <!-- Password Confirmation Field -->
        <div class="mb-3">
          <%= f.label :password_confirmation, t('.fields.password_confirmation.label'), class: 'form-label' %>
          <%= f.password_field :password_confirmation, required: true, minlength: min_password_length,
                class: "form-control#{' is-invalid' if @form.errors[:password_confirmation].any?}",
                data: { action: 'blur->better_together--form-validation#validate', 'better_together--form-validation-min-length-value': min_password_length } %>
          <% if @form.errors[:password_confirmation].any? %>
            <div class="invalid-feedback d-block"><%= @form.errors[:password_confirmation].join(', ') %></div>
          <% end %>
        </div>

        <!-- Profile Details -->
        <h4 class="mt-4 mb-3"><%= t('.profile_section.title') %></h4>
        <p class="small text-muted">
          <%= t('.profile_section.help') %>
        </p>

        <%= f.fields_for :person do |person_form| %>
          <!-- Name Field -->
          <div class="mb-3">
            <%= person_form.label :name, t('.fields.name.label'), class: 'form-label' %>
            <%= person_form.text_field :name, required: true,
                  class: "form-control#{' is-invalid' if @form.errors[:name].any?}",
                  data: { action: 'blur->better_together--form-validation#validate' } %>
            <small class="form-text text-muted">
              <%= t('.fields.name.help') %>
            </small>
            <% if @form.errors[:name].any? %>
              <div class="invalid-feedback d-block"><%= @form.errors[:name].join(', ') %></div>
            <% end %>
          </div>

          <!-- Username/Identifier Field -->
          <div class="mb-3">
            <%= person_form.label :identifier, t('.fields.identifier.label'), class: 'form-label' %>
            <%= person_form.text_field :identifier, required: true,
                  class: "form-control#{' is-invalid' if @form.errors[:identifier].any?}",
                  data: { action: 'blur->better_together--form-validation#validate' } %>
            <small class="form-text text-muted">
              <%= t('.fields.identifier.help') %>
            </small>
            <% if @form.errors[:identifier].any? %>
              <div class="invalid-feedback d-block"><%= @form.errors[:identifier].join(', ') %></div>
            <% end %>
          </div>

          <!-- Description Field -->
          <div class="mb-3">
            <%= person_form.label :description, t('.fields.description.label'), class: 'form-label' %>
            <%= person_form.text_area :description, required: true, rows: 3,
                  class: "form-control#{' is-invalid' if @form.errors[:description].any?}",
                  data: { action: 'blur->better_together--form-validation#validate' } %>
            <small class="form-text text-muted">
              <%= t('.fields.description.help') %>
            </small>
            <% if @form.errors[:description].any? %>
              <div class="invalid-feedback d-block"><%= @form.errors[:description].join(', ') %></div>
            <% end %>
          </div>
        <% end %>

        <!-- Submit Button -->
        <div class="mb-3">
          <%= f.submit t('.buttons.submit'), class: 'btn btn-primary w-100' %>
        </div>
      </div>
    </div>
  </div>
<% end %>
