---
openapi: 3.0.1
info:
  title: Community Engine API
  version: v1
  description: |
    Better Together Community Engine REST API

    ## Authentication

    Most endpoints require JWT authentication via Bearer token in the Authorization header.
    See the Authentication section for how to obtain tokens via sign-in.
paths:
  "/api/auth/confirmation":
    post:
      summary: Resend confirmation instructions
      tags:
      - Authentication
      description: Resend email confirmation instructions to the user. Always returns
        success to prevent email enumeration attacks.
      parameters:
      - name: Accept-Language
        in: header
        required: false
        description: Preferred language for email content
        example: en
        schema:
          type: string
      responses:
        '200':
          description: confirmation instructions sent (or email not found - same response
            to prevent enumeration)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                required:
                - message
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      description: Email address to send confirmation instructions
                  required:
                  - email
              required:
              - user
        required: true
    get:
      summary: Confirm email address
      tags:
      - Authentication
      description: Confirm user email address using the token received via email
      parameters:
      - name: confirmation_token
        in: query
        required: true
        description: Token received via confirmation email
        schema:
          type: string
      - name: Accept-Language
        in: header
        required: false
        description: Preferred language for response messages
        example: en
        schema:
          type: string
      responses:
        '200':
          description: email successfully confirmed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                required:
                - message
        '422':
          description: already confirmed
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    description: Validation error messages
                required:
                - errors
  "/api/auth/password":
    post:
      summary: Request password reset email
      tags:
      - Authentication
      description: Send password reset instructions to the user's email address. Always
        returns success to prevent email enumeration attacks.
      parameters:
      - name: Accept-Language
        in: header
        required: false
        description: Preferred language for email content
        example: en
        schema:
          type: string
      responses:
        '200':
          description: reset instructions sent (or email not found - same response
            to prevent enumeration)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                required:
                - message
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      description: Email address to send password reset instructions
                  required:
                  - email
              required:
              - user
        required: true
    put:
      summary: Reset password with token
      tags:
      - Authentication
      description: Reset user password using the token received via email
      parameters:
      - name: Accept-Language
        in: header
        required: false
        description: Preferred language for error messages
        example: en
        schema:
          type: string
      responses:
        '204':
          description: password successfully reset
        '422':
          description: weak password
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: object
                    description: Validation errors by field name
                    additionalProperties:
                      type: array
                      items:
                        type: string
                required:
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    reset_password_token:
                      type: string
                      description: Token received via password reset email
                    password:
                      type: string
                      format: password
                      description: New password (minimum 8 characters, must include
                        uppercase, lowercase, and special characters)
                      minLength: 8
                    password_confirmation:
                      type: string
                      format: password
                      description: Password confirmation (must match password)
                  required:
                  - reset_password_token
                  - password
                  - password_confirmation
              required:
              - user
        required: true
  "/api/auth/sign-up":
    post:
      summary: Create a new user account
      tags:
      - Authentication
      description: Register a new user account with email and password. Requires acceptance
        of platform agreements.
      parameters:
      - name: Accept-Language
        in: header
        required: false
        description: Preferred language for error messages
        example: en
        schema:
          type: string
      responses:
        '201':
          description: user created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Confirmation message about account status
                  data:
                    type: object
                    properties:
                      type:
                        type: string
                        example: users
                      id:
                        type: string
                        format: uuid
                      attributes:
                        type: object
                        properties:
                          email:
                            type: string
                            format: email
                          confirmed:
                            type: boolean
                            description: Whether email is confirmed (false for new
                              accounts)
                required:
                - message
                - data
        '422':
          description: missing agreements
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    description: Array of validation error messages
                required:
                - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      description: User email address
                    password:
                      type: string
                      format: password
                      description: User password (minimum 8 characters, must include
                        uppercase, lowercase, and special characters)
                      minLength: 8
                    password_confirmation:
                      type: string
                      format: password
                      description: Password confirmation (must match password)
                    person_attributes:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Display name for the user
                        identifier:
                          type: string
                          description: Unique identifier/username for the user
                        description:
                          type: string
                          description: Optional profile description
                      required:
                      - name
                      - identifier
                  required:
                  - email
                  - password
                  - password_confirmation
                  - person_attributes
                privacy_policy_agreement:
                  type: string
                  description: Must be "1" to indicate acceptance
                  enum:
                  - '1'
                terms_of_service_agreement:
                  type: string
                  description: Must be "1" to indicate acceptance
                  enum:
                  - '1'
                code_of_conduct_agreement:
                  type: string
                  description: Must be "1" to indicate acceptance
                  enum:
                  - '1'
              required:
              - user
              - privacy_policy_agreement
              - terms_of_service_agreement
              - code_of_conduct_agreement
        required: true
  "/api/auth/sign-in":
    post:
      summary: Sign in to obtain JWT token
      tags:
      - Authentication
      description: Authenticate with email and password to receive a JWT token for
        subsequent API requests
      parameters:
      - name: Accept-Language
        in: header
        required: false
        description: Preferred language for error messages
        example: en
        schema:
          type: string
      responses:
        '200':
          description: successful authentication
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      type:
                        type: string
                        example: sessions
                      id:
                        type: string
                        format: uuid
                      attributes:
                        type: object
                        properties:
                          email:
                            type: string
                            format: email
                          token:
                            type: string
                            description: JWT token for authentication
                          confirmed:
                            type: boolean
                            description: Whether email is confirmed
                      relationships:
                        type: object
                        properties:
                          person:
                            type: object
                            properties:
                              data:
                                type: object
                                nullable: true
                                properties:
                                  type:
                                    type: string
                                    example: people
                                  id:
                                    type: string
                                    format: uuid
                  included:
                    type: array
                    description: Related resources (person profile if exists)
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          example: people
                        id:
                          type: string
                          format: uuid
                        attributes:
                          type: object
                          properties:
                            name:
                              type: string
                            identifier:
                              type: string
                            privacy:
                              type: string
                            locale:
                              type: string
                            time_zone:
                              type: string
                required:
                - data
        '401':
          description: unconfirmed account
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message describing authentication failure
                required:
                - error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      description: User email address
                    password:
                      type: string
                      format: password
                      description: User password
                  required:
                  - email
                  - password
              required:
              - user
        required: true
  "/api/auth/sign-out":
    delete:
      summary: Sign out and invalidate JWT token
      tags:
      - Authentication
      description: Sign out from the current session. Requires a valid JWT token in
        the Authorization header.
      security:
      - bearer_auth: []
      parameters:
      - name: Accept-Language
        in: header
        required: false
        description: Preferred language for error messages
        example: en
        schema:
          type: string
      - name: Authorization
        in: header
        required: true
        description: JWT token
        example: Bearer eyJhbGciOiJIUzI1NiJ9...
        schema:
          type: string
      responses:
        '200':
          description: successfully signed out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Logout success message
                required:
                - message
        '401':
          description: missing authorization header
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message indicating missing authentication
                required:
                - error
servers:
- url: http://localhost:3000
  description: Platform server
components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from sign-in endpoint
  schemas:
    ValidationErrors:
      type: object
      description: Standard validation error response format
      properties:
        errors:
          type: array
          items:
            type: string
          description: Array of human-readable error messages
          example:
          - Email can't be blank
          - Password is too short
    User:
      type: object
      description: User account with authentication credentials
      properties:
        id:
          type: string
          format: uuid
          description: Unique user identifier
        email:
          type: string
          format: email
          description: User email address
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp
      required:
      - id
      - email
      - created_at
